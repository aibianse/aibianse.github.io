import{d as P,s as V,r as n,u as q,v as $,o as A,ai as E,x as F,c as p,b as s,e as W,f as k,g as t,n as y,F as O,h as T,k as m,aj as G,m as H,ak as J,j as i,y as C,A as K,B as Q,N as X,D as Y,q as Z}from"./index-77da83a3.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-176f6c1a.js";import{_ as ae}from"./R18Permission.vue_vue_type_script_setup_true_lang-b594e347.js";import{N as se}from"./Spin-b065c18e.js";import"./index-fcb6b430.js";const te={class:"flex flex-col w-full h-full"},oe={class:"flex-1 overflow-hidden"},ne={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},le={class:"image_wrap"},re={class:"w-full max-w-screen-xl m-auto"},ie={class:"flex items-center justify-between space-x-2"},ce=P({__name:"ImageSetDetail",setup(ue){const b=V(),f=n(!1),N=b.token,{isMobile:o}=q(),c=$(),g=G(),D=H(),_=n([]),r=n(1),v=n(!1),h=n(0),I=n(""),S=n(!1),j="aibianse.pages.dev",B="cdn.aibianse.com";function M(e){if(!e)return"";try{return e.replace(j,B)}catch(l){return console.error("URL replace error:",l),e}}async function x(e,l){try{v.value=!0,_.value=[];const a=await J(e,l);I.value=a.data.name||"图片集",S.value=a.data.x_rated>0;const u=a.data.rows||[];if(!u.length){c.warning("没有找到图片");return}h.value=Math.max(1,Math.ceil(a.data.total/a.data.page_size));const w=u.map(d=>({...d,url:d.url.startsWith("http")?M(d.url):`https://${d.url}`}));w.length?_.value=w:c.warning("处理后没有有效的图片")}catch(a){console.error("fetchImageCollection error:",a),c.error("查询失败！")}finally{v.value=!1}}async function U(e){r.value=e,await x(g.params.id,r.value)}A(async()=>{const e=g.params.id;if(!e){c.error("参数错误"),D.push("/image/search");return}await x(e,r.value),E(e)});const z=F(()=>{let e=["p-4"];return o.value&&(e=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),e});function L(){f.value=!0}function R(){f.value=!1}return(e,l)=>(i(),p("div",te,[s(o)?(i(),W(ee,{key:0})):k("",!0),t("main",oe,[t("div",ne,[t("div",{id:"image-wrapper image-scroll-container",class:y(["w-full max-w-screen-xl m-auto dark:bg-[#101014]",[s(o)?"p-2":"p-4"]])},[t("div",le,[(i(!0),p(O,null,T(_.value,(a,u)=>(i(),p("div",{key:u,class:"image_item"},[m(s(X),{lazy:"",src:a.url,"intersection-observer-options":{root:null,rootMargin:"0px 0px 200px 0px",threshold:.5}},{placeholder:C(()=>[t("div",{style:K({width:"100%",height:s(o)?"200px":"300px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[m(s(se),null,{default:C(()=>[Q(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src","intersection-observer-options"]),a.x_rated===20&&s(N)===void 0?(i(),p("div",{key:0,class:"unlock-button",onClick:L}," 点击解锁查看 ")):k("",!0)]))),128))])],2)]),m(ae,{visible:f.value,onCancel:R},null,8,["visible"])]),t("footer",{class:y(s(z))},[t("div",re,[t("div",ie,[m(s(Y),{page:r.value,"onUpdate:page":[l[0]||(l[0]=a=>r.value=a),U],"page-count":h.value,size:"large",simple:s(o),"page-slot":s(o)?void 0:5,"show-quick-jumper":!s(o)},null,8,["page","page-count","simple","page-slot","show-quick-jumper"])])])],2)]))}});const ge=Z(ce,[["__scopeId","data-v-4499eeb7"]]);export{ge as default};
