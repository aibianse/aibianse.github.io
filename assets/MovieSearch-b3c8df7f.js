import{am as z,d as E,u as U,m as d,v as q,w as M,c,a as l,b as A,e as S,f as e,n as w,j as m,x as $,an as G,a2 as P,ao as Q,ap as N,F as x,r as k,p as W,g as X,i,D as Y,_ as Z,I as ee,$ as se,t as h,N as te,h as oe,aq as ae,k as ne}from"./index-7654caff.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-6abdcf4b.js";const ce=z("movie",{state:()=>({searchKeyword:"",searchResults:[]}),actions:{setSearchResults(r){this.searchResults=r},setSearchKeyword(r){this.searchKeyword=r}}}),H=r=>(W("data-v-ec535c8b"),r=r(),X(),r),le={class:"flex flex-col w-full h-full"},re={class:"flex-1 overflow-hidden"},ue={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},de={class:"movie-search-container"},he={class:"search-container"},ve={class:"search-wrapper"},_e={class:"search-input-wrapper"},fe={key:0,class:"suggestion-section"},pe={class:"section-header"},ge=H(()=>e("span",null,"搜索历史",-1)),me=["onClick"],ye={class:"history-list"},Se={class:"history-grid"},we=["onClick"],xe={class:"history-text"},ke=["onClick"],Ce={class:"suggestion-section"},be=H(()=>e("div",{class:"section-header"},[e("span",null,"热搜榜")],-1)),Ie={class:"hot-search-list"},Me=["onClick"],$e={class:"hot-text"},Ne={class:"results-container"},He=["onClick"],Ke={class:"movie-image"},Re={class:"movie-info"},Te={class:"type-tag"},Be=E({__name:"MovieSearch",setup(r){const{isMobile:C}=U(),K=oe(),v=ce(),_=d(v.searchKeyword),R=q(()=>v.searchResults),f=d(!1),o=d([]),T=d(!1),B=d([{text:"娼年",tag:"热"},{text:"回复术士的重来人生",tag:"热"}]),p=d(!1);let n=null;const y=d(!1);function F(){n&&(clearTimeout(n),n=null),p.value=!0}function b(){n=setTimeout(()=>{y.value||(p.value=!1)},200)}function O(){n&&(clearTimeout(n),n=null)}function D(){b()}M(()=>{n&&(clearTimeout(n),n=null)});function J(a){if(!a.trim())return;const t=o.value.indexOf(a);t>-1&&o.value.splice(t,1),o.value.unshift(a),o.value.length>10&&o.value.pop(),localStorage.setItem("movieSearchHistory",JSON.stringify(o.value))}o.value=JSON.parse(localStorage.getItem("movieSearchHistory")||"[]");async function g(a){a&&(_.value=a),p.value=!1;const t=a||_.value;if(t.trim()){T.value=!1,f.value=!0;try{const s=await ae(t);s.code===0&&(v.setSearchResults(s.data),v.setSearchKeyword(t),J(t))}catch(s){console.error("Search failed:",s)}finally{f.value=!1}}}function L(){o.value=[],localStorage.removeItem("movieSearchHistory")}function V(a){switch(a){case"热":return"hot";case"新":return"new";case"直播中":return"live";default:return""}}function j(a){y.value=!0,o.value.splice(a,1),localStorage.setItem("movieSearchHistory",JSON.stringify(o.value)),setTimeout(()=>{y.value=!1},300)}return M(()=>{v.setSearchKeyword(_.value)}),(a,t)=>(i(),c("div",le,[l(C)?(i(),A(ie,{key:0})):S("",!0),e("main",re,[e("div",ue,[e("div",{id:"movie-wrapper",class:w(["w-full max-w-screen-xl m-auto",[l(C)?"p-2":"p-4"]])},[e("div",de,[e("div",he,[e("div",ve,[e("div",_e,[m(l(se),{value:_.value,"onUpdate:value":t[1]||(t[1]=s=>_.value=s),type:"text",placeholder:"请输入影视名称关键字",clearable:"",loading:f.value,onKeyup:t[2]||(t[2]=G(s=>g(),["enter"])),onFocus:F,onBlur:b},{suffix:$(()=>[m(l(Y),{disabled:f.value,secondary:"",onClick:t[0]||(t[0]=s=>g())},{icon:$(()=>[m(l(Z),{icon:l(ee).nav.search,class:"search-icon"},null,8,["icon"])]),_:1},8,["disabled"])]),_:1},8,["value","loading"])]),P(e("div",{class:"search-suggestions",onMouseenter:O,onMouseleave:D},[o.value.length>0?(i(),c("div",fe,[e("div",pe,[ge,e("span",{class:"clear-history",onClick:N(L,["stop"])},"清空",8,me)]),e("div",ye,[e("div",Se,[(i(!0),c(x,null,k(o.value,(s,u)=>(i(),c("div",{key:`history-${u}`,class:"history-item",onClick:I=>g(s)},[e("span",xe,h(s),1),e("span",{class:"delete-icon",onClick:N(I=>j(u),["stop","prevent"])},"×",8,ke)],8,we))),128))])])])):S("",!0),e("div",Ce,[be,e("div",Ie,[(i(!0),c(x,null,k(B.value,(s,u)=>(i(),c("div",{key:`hot-${u}`,class:"suggestion-item",onClick:I=>g(s.text)},[e("span",{class:w(["hot-rank",{"top-3":u<3}])},h(u+1),3),e("span",$e,h(s.text),1),s.tag?(i(),c("span",{key:0,class:w(["hot-tag",V(s.tag)])},h(s.tag),3)):S("",!0)],8,Me))),128))])])],544),[[Q,p.value]])])]),e("div",Ne,[(i(!0),c(x,null,k(l(R),s=>(i(),c("div",{key:s.vod_id,class:"movie-card",onClick:u=>l(K).push(`/movie/movie-detail/${s.vod_id}`)},[e("div",Ke,[m(l(te),{lazy:"",src:s.vod_pic,alt:s.vod_name,"preview-disabled":"","object-fit":"cover","intersection-observer-options":{root:"#scrollRef",rootMargin:"200px 0px",threshold:.1}},null,8,["src","alt","intersection-observer-options"])]),e("div",Re,[e("h3",null,h(s.vod_name),1),e("span",Te,h(s.type_name),1)])],8,He))),128))])])],2)])])]))}});const De=ne(Be,[["__scopeId","data-v-ec535c8b"]]);export{De as default};
