import{J as pe,K as le,L as ge,d as de,M as we,O as be,m as f,P as ye,Q as _e,R as fe,v as C,S as Ce,U as Te,V as oe,W as _,X as Se,Y as xe,Z as Ie,$ as me,a0 as Be,a1 as ke,a2 as Re,a3 as Fe,a4 as Ve,a5 as Oe,a6 as Pe,a7 as Ae,a8 as Me,a9 as R,aa as M,q as ze,u as Ee,o as $e,w as Ue,ab as Ne,s as De,ac as je,c as A,a as s,b as Le,e as Ke,f as g,n as se,F as re,r as ie,j as v,x as p,ad as He,i as F,C as We,t as qe,ae as Je,D as V,_ as ue,A as K,af as Qe,h as Xe,ag as ce,p as Ye,g as Ze,k as Ge}from"./main-5959a9b2.js";import{_ as et}from"./index.vue_vue_type_script_setup_true_lang-e897583c.js";import{A as tt}from"./index-a55440c5.js";const at=pe([le("auto-complete",`
 z-index: auto;
 position: relative;
 display: inline-flex;
 width: 100%;
 `),le("auto-complete-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[ge({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]);function nt(a){return a.map(he)}function he(a){var h,r;return typeof a=="string"?{label:a,value:a}:a.type==="group"?{type:"group",label:(h=a.label)!==null&&h!==void 0?h:a.name,value:(r=a.value)!==null&&r!==void 0?r:a.name,key:a.key||a.name,children:a.children.map(c=>he(c))}:a}const ot=Object.assign(Object.assign({},fe.props),{to:oe.propTo,menuProps:Object,append:Boolean,bordered:{type:Boolean,default:void 0},clearable:{type:Boolean,default:void 0},defaultValue:{type:String,default:null},loading:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},placeholder:String,placement:{type:String,default:"bottom-start"},value:String,blurAfterSelect:Boolean,clearAfterSelect:Boolean,getShow:Function,showEmpty:Boolean,inputProps:Object,renderOption:Function,renderLabel:Function,size:String,options:{type:Array,default:()=>[]},zIndex:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onSelect:[Function,Array],onBlur:[Function,Array],onFocus:[Function,Array],onInput:[Function,Array]}),lt=de({name:"AutoComplete",props:ot,slots:Object,setup(a){const{mergedBorderedRef:h,namespaceRef:r,mergedClsPrefixRef:i,inlineThemeDisabled:c}=we(a),m=be(a),{mergedSizeRef:H,mergedDisabledRef:W,mergedStatusRef:z}=m,T=f(null),S=f(null),x=f(a.defaultValue),q=ye(a,"value"),b=_e(q,x),d=f(!1),O=f(!1),E=fe("AutoComplete","-auto-complete",at,Oe,a,i),I=C(()=>nt(a.options)),B=C(()=>{const{getShow:t}=a;return t?t(b.value||""):!!b.value}),$=C(()=>B.value&&d.value&&(a.showEmpty?!0:!!I.value.length)),J=C(()=>Pe(I.value,Me("value","children")));function y(t){const{"onUpdate:value":l,onUpdateValue:u,onInput:w}=a,{nTriggerFormInput:L,nTriggerFormChange:ve}=m;u&&R(u,t),l&&R(l,t),w&&R(w,t),x.value=t,L(),ve()}function Q(t){const{onSelect:l}=a,{nTriggerFormInput:u,nTriggerFormChange:w}=m;l&&R(l,t),u(),w()}function U(t){const{onBlur:l}=a,{nTriggerFormBlur:u}=m;l&&R(l,t),u()}function X(t){const{onFocus:l}=a,{nTriggerFormFocus:u}=m;l&&R(l,t),u()}function Y(){O.value=!0}function N(){window.setTimeout(()=>{O.value=!1},0)}function D(t){var l,u,w;switch(t.key){case"Enter":if(!O.value){const L=(l=S.value)===null||l===void 0?void 0:l.getPendingTmNode();L&&(P(L.rawNode),t.preventDefault())}break;case"ArrowDown":(u=S.value)===null||u===void 0||u.next();break;case"ArrowUp":(w=S.value)===null||w===void 0||w.prev();break}}function P(t){(t==null?void 0:t.value)!==void 0&&(Q(t.value),a.clearAfterSelect?y(null):t.label!==void 0&&y(a.append?`${b.value}${t.label}`:t.label),d.value=!1,a.blurAfterSelect&&k())}function Z(){y(null)}function G(t){d.value=!0,X(t)}function ee(t){d.value=!1,U(t)}function te(t){d.value=!0,y(t)}function ae(t){P(t.rawNode)}function ne(t){var l;!((l=T.value)===null||l===void 0)&&l.contains(Ae(t))||(d.value=!1)}function k(){var t,l;!((t=T.value)===null||t===void 0)&&t.contains(document.activeElement)&&((l=document.activeElement)===null||l===void 0||l.blur())}const j=C(()=>{const{common:{cubicBezierEaseInOut:t},self:{menuBoxShadow:l}}=E.value;return{"--n-menu-box-shadow":l,"--n-bezier":t}}),e=c?Ce("auto-complete",void 0,j,a):void 0,o=f(null),n={focus:()=>{var t;(t=o.value)===null||t===void 0||t.focus()},blur:()=>{var t;(t=o.value)===null||t===void 0||t.blur()}};return{focus:n.focus,blur:n.blur,inputInstRef:o,uncontrolledValue:x,mergedValue:b,isMounted:Te(),adjustedTo:oe(a),menuInstRef:S,triggerElRef:T,treeMate:J,mergedSize:H,mergedDisabled:W,active:$,mergedStatus:z,handleClear:Z,handleFocus:G,handleBlur:ee,handleInput:te,handleToggle:ae,handleClickOutsideMenu:ne,handleCompositionStart:Y,handleCompositionEnd:N,handleKeyDown:D,mergedTheme:E,cssVars:c?void 0:j,themeClass:e==null?void 0:e.themeClass,onRender:e==null?void 0:e.onRender,mergedBordered:h,namespace:r,mergedClsPrefix:i}},render(){const{mergedClsPrefix:a}=this;return _("div",{class:`${a}-auto-complete`,ref:"triggerElRef",onKeydown:this.handleKeyDown,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd},_(Se,null,{default:()=>[_(xe,null,{default:()=>{const h=this.$slots.default;if(h)return Ie("default",h,{handleInput:this.handleInput,handleFocus:this.handleFocus,handleBlur:this.handleBlur,value:this.mergedValue});const{mergedTheme:r}=this;return _(me,{ref:"inputInstRef",status:this.mergedStatus,theme:r.peers.Input,themeOverrides:r.peerOverrides.Input,bordered:this.mergedBordered,value:this.mergedValue,placeholder:this.placeholder,size:this.mergedSize,disabled:this.mergedDisabled,clearable:this.clearable,loading:this.loading,inputProps:this.inputProps,onClear:this.handleClear,onFocus:this.handleFocus,onUpdateValue:this.handleInput,onBlur:this.handleBlur},{suffix:()=>{var i,c;return(c=(i=this.$slots).suffix)===null||c===void 0?void 0:c.call(i)},prefix:()=>{var i,c;return(c=(i=this.$slots).prefix)===null||c===void 0?void 0:c.call(i)}})}}),_(Be,{show:this.active,to:this.adjustedTo,containerClass:this.namespace,zIndex:this.zIndex,teleportDisabled:this.adjustedTo===oe.tdkey,placement:this.placement,width:"target"},{default:()=>_(ke,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{var h;if((h=this.onRender)===null||h===void 0||h.call(this),!this.active)return null;const{menuProps:r}=this;return Re(_(Ve,Object.assign({},r,{clsPrefix:a,ref:"menuInstRef",theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,"auto-pending":!0,class:[`${a}-auto-complete-menu`,this.themeClass,r==null?void 0:r.class],style:[r==null?void 0:r.style,this.cssVars],treeMate:this.treeMate,multiple:!1,renderLabel:this.renderLabel,renderOption:this.renderOption,size:"medium",onToggle:this.handleToggle}),{empty:()=>{var i,c;return(c=(i=this.$slots).empty)===null||c===void 0?void 0:c.call(i)}}),[[Fe,this.handleClickOutsideMenu,void 0,{capture:!0}]])}})})]}))}});function st(){const a=f(null);return{scrollRef:a,scrollToBottom:async()=>{await M(),a.value&&(a.value.scrollTop=a.value.scrollHeight)},scrollToTop:async()=>{await M(),a.value&&(a.value.scrollTop=0)},scrollToBottomIfAtBottom:async()=>{await M(),a.value&&a.value.scrollHeight-a.value.scrollTop-a.value.clientHeight<=100&&(a.value.scrollTop=a.value.scrollHeight)}}}const rt=a=>(Ye("data-v-705dc918"),a=a(),Ze(),a),it={class:"flex flex-col w-full h-full"},ut={class:"flex-1 overflow-hidden"},ct=["onClick"],dt=rt(()=>g("span",{class:"block text-base text-center text-slate-500 dark:text-slate-400 mb-2"}," 广告位招租 ",-1)),ft={style:{"text-align":"center"}},mt={class:"w-full max-w-screen-xl m-auto"},ht={class:"flex items-center justify-between space-x-2"},vt={class:"button-spacing"},pt={class:"dark:text-black"},gt=de({__name:"ImageSetSearch",setup(a){const h=Xe(),r=ze(),i=f([]),c=new AbortController,{isMobile:m}=Ee(),{scrollRef:H,scrollToBottom:W}=st(),z=f(!1),T=f(null),S=f(null),x=f(!1),q=C(()=>{let e=["p-4"];return m.value&&(e=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),e}),b=f([]),d=f(""),O=f([]),E=f(!1),I=f([]);$e(async()=>{try{if(!await D(10,1))throw new Error("加载图片集合失败");await W(),!m.value&&T.value&&T.value.focus()}catch(e){console.error("Initialization error:",e),r.error(e instanceof Error?e.message:"初始化失败")}}),Ue(()=>{z.value&&c.abort(),I.value=[],O.value=[]});async function B(){await Q(d.value),await $()}async function $(){I.value[I.value.length-1].scrollIntoView({behavior:"smooth"})}const J=e=>{e&&I.value.push(e)};async function y(e,o){try{return(await He(e,o)).data}catch(n){return r.error(n instanceof Error?n.message:"搜索内容失败 or 搜索内容不存在"),null}}async function Q(e){if(!(e!=null&&e.trim()))return;d.value="";const o=await y(e,1);o&&b.value.push({search_keyword:e,image_data:o.rows,totalPages:Math.ceil(o.total/10),currentPage:1})}async function U(e,o){const t=await(e.search_keyword==="   目录   "?()=>P(10,o):()=>y(e.search_keyword,o))();t&&(e.image_data=t.rows,e.currentPage=o)}const X=C(()=>z.value||!d.value||d.value.trim()==="");function Y(e){m.value?e.key==="Enter"&&e.ctrlKey&&(e.preventDefault(),B()):e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),B())}const N=C(()=>m.value?ce("chat.placeholderMobile"):ce("chat.placeholder"));async function D(e,o){try{const n=f("");if(e===10)n.value="   目录   ";else if(e===20)n.value="最热";else if(e===30)n.value="最新";else if(e===40)n.value="巧遇";else throw new Error("类型错误！");const t=await P(e,o);if(!t)throw new Error("获取数据失败");return b.value.push({search_keyword:n.value,image_data:t.rows,totalPages:Math.ceil(t.total/10),currentPage:1}),await M(),await $(),!0}catch(n){return console.error("clickImageCollectionByType error:",n),r.error(n instanceof Error?n.message:"操作失败"),!1}}async function P(e,o){try{const n=await Ne(e,o);if(!(n!=null&&n.data))throw new Error("获取数据失败");return n.data}catch(n){throw console.error("fetchImageCollectionByType error:",n),n}}const Z=e=>_("div",{style:"padding: 4px 0"},e.label),G=async e=>{if(!(e!=null&&e.trim())){i.value=[];return}try{const o=await y(e.trim(),1);if(!o){i.value=[];return}i.value=o.rows.filter(n=>n.name.toLowerCase().includes(e.toLowerCase())).slice(0,10).map(n=>({label:n.name,value:n.name}))}catch(o){console.error("Failed to fetch search suggestions:",o),i.value=[]}},ee=De(async e=>{await G(e)},300),te=e=>{d.value=e,ee(e)},ae=e=>{d.value=e,B()},ne=e=>{m.value&&e.target&&window.setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},300)};je(()=>E.value,async e=>{e&&(await M(),S.value&&(S.value.scrollTop=0))});function k(e,o){D(e,o),x.value=!1}const j=e=>{m.value&&e.target&&window.setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},300)};return(e,o)=>(F(),A("div",it,[s(m)?(F(),Le(et,{key:0})):Ke("",!0),g("main",ut,[g("div",{id:"scrollRef",ref_key:"scrollRef",ref:H,class:"h-full overflow-hidden overflow-y-auto"},[g("div",{id:"image-wrapper image-scroll-container",class:se(["w-full max-w-screen-xl m-auto dark:bg-[#101014]",[s(m)?"p-2":"p-4"]])},[(F(!0),A(re,null,ie(b.value,(n,t)=>(F(),A("div",{key:n.search_keyword+t,ref_for:!0,ref:J,class:"image_card"},[v(s(Je),{title:`搜索关键字：${n.search_keyword}`,segmented:{content:!0,footer:"soft"}},{"header-extra":p(()=>[]),footer:p(()=>[dt,g("div",null,[v(tt)])]),action:p(()=>[g("div",ft,[v(s(We),{page:n.currentPage,"onUpdate:page":[l=>n.currentPage=l,l=>U(n,n.currentPage)],"page-count":n.totalPages,size:"large",simple:"","onUpdate:pageSize":l=>U(n,n.currentPage)},null,8,["page","onUpdate:page","page-count","onUpdate:pageSize"])])]),default:p(()=>[g("ul",null,[(F(!0),A(re,null,ie(n.image_data,(l,u)=>(F(),A("li",{key:u,class:"image_name",onClick:w=>s(h).push(`/image/image-set-detail/${l.id}`)},qe(`${u+1}、${l.name}`),9,ct))),128))])]),_:2},1032,["title"])]))),128))],2)],512)]),g("footer",{class:se(s(q))},[g("div",mt,[g("div",ht,[v(s(Qe),{show:x.value,"onUpdate:show":o[4]||(o[4]=n=>x.value=n),overlap:!1,placement:"top",trigger:"click"},{trigger:p(()=>[v(s(V),null,{default:p(()=>[v(s(ue),{icon:"ep:menu"})]),_:1})]),default:p(()=>[g("div",vt,[v(s(V),{onClick:o[0]||(o[0]=n=>k(10,1))},{default:p(()=>[K(" 目录 ")]),_:1}),v(s(V),{onClick:o[1]||(o[1]=n=>k(20,1))},{default:p(()=>[K(" 最热 ")]),_:1}),v(s(V),{onClick:o[2]||(o[2]=n=>k(30,1))},{default:p(()=>[K(" 最新 ")]),_:1}),v(s(V),{onClick:o[3]||(o[3]=n=>k(40,1))},{default:p(()=>[K(" 巧遇 ")]),_:1})])]),_:1},8,["show"]),v(s(lt),{value:d.value,"onUpdate:value":[o[7]||(o[7]=n=>d.value=n),te],options:i.value,"render-label":Z,"input-props":{placeholder:s(N),type:"textarea",autosize:{minRows:1,maxRows:s(m)?4:8}},style:{width:"70%"},onSelect:ae,onFocus:j},{default:p(({handleInput:n,handleBlur:t,handleFocus:l})=>[v(s(me),{ref_key:"inputRef",ref:T,value:d.value,"onUpdate:value":[o[5]||(o[5]=u=>d.value=u),n],type:"textarea",clearable:"",placeholder:s(N),autosize:{minRows:1,maxRows:s(m)?4:8},onFocus:u=>{l(u),ne(u)},onBlur:t,onKeypress:Y,onClear:o[6]||(o[6]=()=>{d.value="",i.value=[]})},null,8,["value","placeholder","autosize","onUpdate:value","onFocus","onBlur"])]),_:1},8,["value","options","input-props"]),v(s(V),{type:"primary",disabled:s(X),onClick:B},{icon:p(()=>[g("span",pt,[v(s(ue),{icon:"lucide:search"})])]),_:1},8,["disabled"])])])],2)]))}});const _t=Ge(gt,[["__scopeId","data-v-705dc918"]]);export{_t as default};
