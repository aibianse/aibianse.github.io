import{d as q,l as $,m as s,u as A,q as E,o as F,ag as W,v as O,c as f,a,b as T,e as N,f as o,n as b,F as G,r as H,j as m,ah as J,h as K,ai as Q,i as u,x as I,z as X,A as Y,B as Z,k as ee}from"./index-e8d7358e.js";import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang-d539e69a.js";import{_ as te}from"./R18Permission.vue_vue_type_script_setup_true_lang-7b6a827d.js";import{N as se}from"./Spin-5a00af5b.js";import{N as oe}from"./Image-c7dcf2aa.js";const le={class:"flex flex-col w-full h-full"},ne={class:"flex-1 overflow-hidden"},re={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},ie={class:"image_wrap"},ce={class:"w-full max-w-screen-xl m-auto"},ue={class:"flex items-center justify-between space-x-2"},de=q({__name:"ImageSetDetail",setup(pe){const D=$(),g=s(!1),h=D.token,{isMobile:l}=A(),i=E(),v=J(),S=K(),_=s([]),c=s(1),x=s(!1),w=s(0),z=s(""),B=s(!1),M="aibianse.pages.dev",U="cdn.aibianse.com";function j(e){if(!e)return"";try{return e.replace(M,U)}catch(n){return console.error("URL replace error:",n),e}}async function k(e,n){var r,d;try{x.value=!0,_.value=[];const t=await Q(e,n);if(!((d=(r=t==null?void 0:t.data)==null?void 0:r.rows)!=null&&d.length)){n===1&&i.warning("没有找到图片");return}z.value=t.data.name||"图片集",B.value=t.data.x_rated>0;const y=t.data.rows||[];if(!y.length){i.warning("没有找到图片");return}w.value=Math.max(1,Math.ceil(t.data.total/t.data.page_size));const C=y.map(p=>({...p,url:p.url.startsWith("http")?j(p.url):`https://${p.url}`}));C.length?_.value=C:i.warning("处理后没有有效的图片")}catch(t){console.error("fetchImageCollection error:",t),i.error("查询失败！")}finally{x.value=!1}}async function L(e){c.value=e,await k(v.params.id,c.value)}F(async()=>{const e=v.params.id;if(!e){i.error("参数错误"),S.push("/image/search");return}await k(e,c.value),W(e)});const R=O(()=>{let e=["p-4"];return l.value&&(e=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),e});s(!1);function P(){g.value=!0}function V(){g.value=!1}return(e,n)=>(u(),f("div",le,[a(l)?(u(),T(ae,{key:0})):N("",!0),o("main",ne,[o("div",re,[o("div",{id:"image-wrapper image-scroll-container",class:b(["w-full max-w-screen-xl m-auto dark:bg-[#101014]",[a(l)?"p-2":"p-4"]])},[o("div",ie,[(u(!0),f(G,null,H(_.value,(r,d)=>(u(),f("div",{key:d,class:"image_item"},[m(a(oe),{lazy:"",src:r.url,"intersection-observer-options":{root:null,rootMargin:"0px 0px 200px 0px",threshold:.5}},{placeholder:I(()=>[o("div",{style:X({width:"100%",height:a(l)?"200px":"300px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[m(a(se),null,{default:I(()=>[Y(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src","intersection-observer-options"]),r.x_rated===20&&(a(h)===!1||a(h)===void 0)?(u(),f("div",{key:0,class:"unlock-button",onClick:P}," 点击解锁查看 ")):N("",!0)]))),128))])],2)]),m(te,{visible:g.value,onCancel:V},null,8,["visible"])]),o("footer",{class:b(a(R))},[o("div",ce,[o("div",ue,[m(a(Z),{page:c.value,"onUpdate:page":[n[0]||(n[0]=r=>c.value=r),L],"page-count":w.value,size:"large",simple:a(l),"page-slot":a(l)?void 0:5,"show-quick-jumper":!a(l)},null,8,["page","page-count","simple","page-slot","show-quick-jumper"])])])],2)]))}});const ve=ee(de,[["__scopeId","data-v-c4a962da"]]);export{ve as default};
