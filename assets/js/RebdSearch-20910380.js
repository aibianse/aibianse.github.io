import{g as e,d as s,v as a,e as t,G as l,E as o,n as r,u as c,c as i,q as n,p as u,H as d,a as v,w as h,P as p,Q as y,U as f,F as m,J as g,M as w,N as k,o as b,V as S,x,t as C,B as R}from"./vue-vendor-ca37f3ab.js";import{e as _,C as K,_ as j}from"./common-c33ca2b3.js";import{I,b as H,a as M}from"./image-modules-ed6fadc5.js";import{h as T,i as J,D as N,q as $}from"./naive-ui-5b39965d.js";import"./utils-f1e0c1c0.js";import"./layout-eff6d669.js";const O=e("rebd",{state:()=>({searchKeyword:"",searchResults:[]}),actions:{setSearchResults(e){this.searchResults=e},setSearchKeyword(e){this.searchKeyword=e},resetStore(){this.$reset()}}}),q=e=>(w("data-v-b773371a"),e=e(),k(),e),z={class:"flex flex-col w-full h-full"},B={class:"flex-1 overflow-hidden"},D={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},F={class:"main-search-container"},U={class:"search-container"},E={class:"search-wrapper"},G={class:"search-input-wrapper"},L={key:0,class:"suggestion-section"},P={class:"section-header"},Q=q((()=>u("span",null,"搜索历史",-1))),V=["onClick"],A={class:"history-list"},W={class:"history-grid"},X=["onClick"],Y={class:"history-text"},Z=["onClick"],ee={class:"suggestion-section"},se=q((()=>u("div",{class:"section-header"},[u("span",null,"热搜榜")],-1))),ae={class:"hot-search-list"},te=["onClick"],le={class:"hot-text"},oe={class:"results-container"},re=["onClick"],ce={class:"cover-image"},ie={class:"cover-info"},ne=M(s({__name:"RebdSearch",setup(e){const{isMobile:s}=_(),w=R(),k=O(),M=a(k.searchKeyword),q=t((()=>k.searchResults)),ne=a(!1),ue=a([]),de=a(!1),ve=a([{text:"娼年",tag:"热"},{text:"回复术士的重来人生",tag:"R18"},{text:"无良公会",tag:"新"}]),he=a(!1);let pe=null;const ye=a(!1);function fe(){pe&&(clearTimeout(pe),pe=null),he.value=!0}function me(){pe=setTimeout((()=>{ye.value||(he.value=!1)}),200)}function ge(){pe&&(clearTimeout(pe),pe=null)}function we(){me()}l((()=>{pe&&(clearTimeout(pe),pe=null)}));try{const e=localStorage.getItem("rebdSearchHistory");e&&(ue.value=JSON.parse(e))}catch(xe){ue.value=[]}async function ke(e){e&&(M.value=e),he.value=!1;const s=e||M.value;if(s.trim()){de.value=!1,ne.value=!0;try{const e=await K(s);0===e.code&&(k.setSearchResults(e.data.rows),k.setSearchKeyword(s),function(e){if(!e.trim())return;const s={keyword:e.trim(),timestamp:Date.now()};ue.value=ue.value.filter((e=>!(e.keyword===s.keyword))),ue.value.unshift(s),ue.value.length>10&&ue.value.pop(),localStorage.setItem("rebdSearchHistory",JSON.stringify(ue.value))}(s))}catch(a){}finally{ne.value=!1}}}function be(){ue.value=[],localStorage.removeItem("rebdSearchHistory")}function Se(e){switch(e){case"热":case"R18":return"hot";case"新":return"new";case"直播中":return"live";default:return""}}return o((()=>{void 0===k.searchResults&&ke("rebd")})),l((()=>{k.setSearchKeyword(M.value)})),(e,a)=>(b(),r("div",z,[c(s)?(b(),i(H,{key:0})):n("",!0),u("main",B,[u("div",D,[u("div",{id:"content-wrapper",class:d(["w-full max-w-screen-xl m-auto",[c(s)?"p-2":"p-4"]])},[u("div",F,[u("div",U,[u("div",E,[u("div",G,[v(c(N),null,{default:h((()=>[v(c(T),{value:M.value,"onUpdate:value":a[1]||(a[1]=e=>M.value=e),style:{width:"85%"},size:"large",type:"text",placeholder:"输入名称关键字",clearable:"",loading:ne.value,onKeyup:a[2]||(a[2]=S((e=>ke()),["enter"])),onFocus:fe,onBlur:me},{suffix:h((()=>[v(c(J),{disabled:ne.value,secondary:"",onClick:a[0]||(a[0]=e=>ke())},{icon:h((()=>[v(c(j),{icon:c(I).nav.search,class:"search-icon"},null,8,["icon"])])),_:1},8,["disabled"])])),_:1},8,["value","loading"]),v(c(J),{style:{width:"15%"},onClick:a[3]||(a[3]=e=>async function(){k.resetStore(),M.value=k.searchKeyword,ke("rebd")}())},{default:h((()=>[x(" 重置 ")])),_:1})])),_:1})]),p(u("div",{class:"search-suggestions",onMouseenter:ge,onMouseleave:we},[ue.value.length>0?(b(),r("div",L,[u("div",P,[Q,u("span",{class:"clear-history",onClick:f(be,["stop"])},"清空",8,V)]),u("div",A,[u("div",W,[(b(!0),r(m,null,g(ue.value,((e,s)=>(b(),r("div",{key:`history-${s}`,class:"history-item",onClick:s=>async function(e){await ke(e.keyword)}(e)},[u("span",Y,C(e.keyword),1),u("span",{class:"delete-icon",onClick:f((e=>function(e){ye.value=!0,ue.value.splice(e,1),localStorage.setItem("rebdSearchHistory",JSON.stringify(ue.value)),setTimeout((()=>{ye.value=!1}),300)}(s)),["stop","prevent"])},"×",8,Z)],8,X)))),128))])])])):n("",!0),u("div",ee,[se,u("div",ae,[(b(!0),r(m,null,g(ve.value,((e,s)=>(b(),r("div",{key:`hot-${s}`,class:"suggestion-item",onClick:s=>ke(e.text)},[u("span",{class:d(["hot-rank",{"top-3":s<3}])},C(s+1),3),u("span",le,C(e.text),1),e.tag?(b(),r("span",{key:0,class:d(["hot-tag",Se(e.tag)])},C(e.tag),3)):n("",!0)],8,te)))),128))])])],544),[[y,he.value]])])]),u("div",oe,[(b(!0),r(m,null,g(c(q),(e=>(b(),r("div",{key:e.code,class:"cover-card",onClick:s=>c(w).push(`/rebd/rebd-detail/${e.code.toLowerCase()}`)},[u("div",ce,[v(c($),{lazy:"",src:e.cover_image_url,alt:e.code,"preview-disabled":"","object-fit":"cover","intersection-observer-options":{root:"#scrollRef",rootMargin:"200px 0px",threshold:.1}},null,8,["src","alt","intersection-observer-options"])]),u("div",ie,[u("h3",null,C(e.code),1)])],8,re)))),128))])])],2)])])]))}}),[["__scopeId","data-v-b773371a"]]);export{ne as default};
