import{g as e,d as a,v as l,e as s,G as o,n as t,u as i,c as n,q as u,p as c,H as r,a as v,w as d,P as p,Q as m,U as f,F as h,J as y,M as g,N as _,o as w,V as k,t as b,x as S,B as x,E as C,C as z,A as M,W as T,X as j,Y as R}from"./vue-vendor-ca37f3ab.js";import{e as H,_ as O,p as I,c as K,q as N}from"./common-8c4f62e8.js";import{I as P,b as q,a as D,c as L}from"./image-modules-54f63cac.js";import{j as B,h as J,i as U,D as $,q as A,E,p as F,v as V,x as W,s as G}from"./naive-ui-5b39965d.js";const Q=e("movie",{state:()=>({searchKeyword:"",searchResults:[],searchSource:1}),actions:{setSearchResults(e){this.searchResults=e},setSearchKeyword(e){this.searchKeyword=e},setSearchSource(e){this.searchSource=e}}}),X=e=>(g("data-v-e876726e"),e=e(),_(),e),Y={class:"flex flex-col w-full h-full"},Z={class:"flex-1 overflow-hidden"},ee={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},ae={class:"movie-search-container"},le={class:"search-container"},se={class:"search-wrapper"},oe={class:"search-input-wrapper"},te={key:0,class:"suggestion-section"},ie={class:"section-header"},ne=X((()=>c("span",null,"搜索历史",-1))),ue=["onClick"],ce={class:"history-list"},re={class:"history-grid"},ve=["onClick"],de={class:"history-text"},pe={class:"source-tag"},me=["onClick"],fe={class:"suggestion-section"},he=X((()=>c("div",{class:"section-header"},[c("span",null,"热搜榜")],-1))),ye={class:"hot-search-list"},ge=["onClick"],_e={class:"hot-text"},we={class:"results-container"},ke=["onClick"],be={class:"movie-info"},Se={class:"type-tag"},xe=D(a({__name:"MovieSearch",setup(e){const{isMobile:a}=H(),g=x(),_=Q(),C=l(_.searchKeyword),z=s((()=>_.searchResults)),M=l(_.searchSource),T=l(!1),j=l([{label:"影视源",value:1},{label:"成人源",value:2}]),R=s((()=>2===M.value)),K=l([]),N=l(!1),D=l([{text:"娼年",tag:"热"},{text:"回复术士的重来人生",tag:"R18"},{text:"无良公会",tag:"新"}]),L=l(!1);let E=null;const F=l(!1);function V(){E&&(clearTimeout(E),E=null),L.value=!0}function W(){E=setTimeout((()=>{F.value||(L.value=!1)}),200)}function G(){E&&(clearTimeout(E),E=null)}function X(){W()}o((()=>{E&&(clearTimeout(E),E=null)}));try{const e=localStorage.getItem("movieSearchHistory");e&&(K.value=JSON.parse(e))}catch(Me){K.value=[]}async function xe(e){e&&(C.value=e),L.value=!1;const a=e||C.value;if(a.trim()){N.value=!1,T.value=!0;try{const e=await I(a,M.value);0===e.code&&(_.setSearchResults(e.data),_.setSearchKeyword(a),_.setSearchSource(M.value),function(e){if(!e.trim())return;const a={keyword:e.trim(),source:M.value,timestamp:Date.now()};K.value=K.value.filter((e=>!(e.keyword===a.keyword&&e.source===a.source))),K.value.unshift(a),K.value.length>10&&K.value.pop(),localStorage.setItem("movieSearchHistory",JSON.stringify(K.value))}(a))}catch(l){}finally{T.value=!1}}}function Ce(){K.value=[],localStorage.removeItem("movieSearchHistory")}function ze(e){switch(e){case"热":case"R18":return"hot";case"新":return"new";case"直播中":return"live";default:return""}}return o((()=>{_.setSearchKeyword(C.value),_.setSearchSource(M.value)})),(e,l)=>(w(),t("div",Y,[i(a)?(w(),n(q,{key:0})):u("",!0),c("main",Z,[c("div",ee,[c("div",{id:"movie-wrapper",class:r(["w-full max-w-screen-xl m-auto",[i(a)?"p-2":"p-4"]])},[c("div",ae,[c("div",le,[c("div",se,[c("div",oe,[v(i($),null,{default:d((()=>[v(i(B),{value:M.value,"onUpdate:value":l[0]||(l[0]=e=>M.value=e),style:{width:"25%"},"default-value":M.value,options:j.value,size:"large",placeholder:"数据源","show-checkmark":!1},null,8,["value","default-value","options"]),v(i(J),{value:C.value,"onUpdate:value":l[2]||(l[2]=e=>C.value=e),style:{width:"75%"},size:"large",type:"text",placeholder:"影视名称关键字",clearable:"",loading:T.value,onKeyup:l[3]||(l[3]=k((e=>xe()),["enter"])),onFocus:V,onBlur:W},{suffix:d((()=>[v(i(U),{disabled:T.value,secondary:"",onClick:l[1]||(l[1]=e=>xe())},{icon:d((()=>[v(i(O),{icon:i(P).nav.search,class:"search-icon"},null,8,["icon"])])),_:1},8,["disabled"])])),_:1},8,["value","loading"])])),_:1})]),p(c("div",{class:"search-suggestions",onMouseenter:G,onMouseleave:X},[K.value.length>0?(w(),t("div",te,[c("div",ie,[ne,c("span",{class:"clear-history",onClick:f(Ce,["stop"])},"清空",8,ue)]),c("div",ce,[c("div",re,[(w(!0),t(h,null,y(K.value,((e,a)=>{var l;return w(),t("div",{key:`history-${a}`,class:"history-item",onClick:a=>async function(e){M.value=e.source,await xe(e.keyword)}(e)},[c("span",de,[c("span",pe,"["+b(null==(l=j.value.find((a=>a.value===e.source)))?void 0:l.label)+"]",1),S(" "+b(e.keyword),1)]),c("span",{class:"delete-icon",onClick:f((e=>function(e){F.value=!0,K.value.splice(e,1),localStorage.setItem("movieSearchHistory",JSON.stringify(K.value)),setTimeout((()=>{F.value=!1}),300)}(a)),["stop","prevent"])},"×",8,me)],8,ve)})),128))])])])):u("",!0),c("div",fe,[he,c("div",ye,[(w(!0),t(h,null,y(D.value,((e,a)=>(w(),t("div",{key:`hot-${a}`,class:"suggestion-item",onClick:a=>xe(e.text)},[c("span",{class:r(["hot-rank",{"top-3":a<3}])},b(a+1),3),c("span",_e,b(e.text),1),e.tag?(w(),t("span",{key:0,class:r(["hot-tag",ze(e.tag)])},b(e.tag),3)):u("",!0)],8,ge)))),128))])])],544),[[m,L.value]])])]),c("div",we,[(w(!0),t(h,null,y(i(z),(e=>(w(),t("div",{key:e.vod_id,class:"movie-card",onClick:a=>i(g).push(`/movie/movie-detail/${M.value}/${e.vod_id}`)},[c("div",{class:r(["movie-image",{"movie-image-horizontal":i(R)}])},[v(i(A),{lazy:"",src:e.vod_pic,alt:e.vod_name,"preview-disabled":"","object-fit":"cover","intersection-observer-options":{root:"#scrollRef",rootMargin:"200px 0px",threshold:.1}},null,8,["src","alt","intersection-observer-options"])],2),c("div",be,[c("h3",null,b(e.vod_name),1),c("span",Se,b(e.type_name),1)])],8,ke)))),128))])])],2)])])]))}}),[["__scopeId","data-v-e876726e"]]),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"})),ze=e=>(g("data-v-a4a08fd5"),e=e(),_(),e),Me={class:"flex flex-col w-full h-full"},Te={class:"flex-1 overflow-hidden"},je={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},Re={class:"movie-detail-container"},He={key:0,class:"player-wrapper"},Oe={key:1,class:"info-section"},Ie={class:"movie-header"},Ke={class:"movie-cover-wrapper"},Ne={class:"movie-info"},Pe={class:"info-item"},qe=ze((()=>c("span",{class:"label"},"类型：",-1))),De={class:"info-item"},Le=ze((()=>c("span",{class:"label"},"导演：",-1))),Be={class:"info-item"},Je=ze((()=>c("span",{class:"label"},"主演：",-1))),Ue={class:"info-items"},$e={class:"info-item"},Ae=ze((()=>c("span",{class:"label"},"地区：",-1))),Ee={class:"info-item"},Fe=ze((()=>c("span",{class:"label"},"语言：",-1))),Ve={class:"info-item"},We=ze((()=>c("span",{class:"label"},"状态：",-1))),Ge={class:"info-item"},Qe=ze((()=>c("span",{class:"label"},"简介：",-1))),Xe=["innerHTML"],Ye={class:"info-item"},Ze=ze((()=>c("span",{class:"label"},"地区：",-1))),ea={class:"info-item"},aa=ze((()=>c("span",{class:"label"},"语言：",-1))),la={class:"info-item"},sa=ze((()=>c("span",{class:"label"},"状态：",-1))),oa={class:"info-item"},ta=ze((()=>c("span",{class:"label"},"简介：",-1))),ia=["innerHTML"],na={key:2,class:"expand-more"},ua={key:2,class:"episodes-section"},ca={class:"pagination-wrapper"},ra=D(a({__name:"MovieDetail",setup(e){const a=K().token,{isMobile:p}=H(),m=M(),f=l(!1),g=l(!0),_=l(null),k=l(""),x=l(0),O=l(!1),I=l({page:1,pageSize:20,itemCount:0}),P=s((()=>{var e;if(!(null==(e=_.value)?void 0:e.vod_play_urls))return[];const a=(I.value.page-1)*I.value.pageSize,l=a+I.value.pageSize;return _.value.vod_play_urls.slice(a,l)}));function D(e){I.value.page=e,window.scrollTo({top:0,behavior:"smooth"})}const B=l(null);function J(e,a,l){if(R.isSupported()){l.hls&&l.hls.destroy();const s=new R;s.loadSource(a),s.attachMedia(e),l.hls=s,l.on("destroy",(()=>s.destroy()))}else e.canPlayType("application/vnd.apple.mpegurl")?e.src=a:l.notice.show="不支持的播放格式：m3u8"}function $(e){B.value&&(B.value.destroy(),B.value=null),z((()=>{const l=document.querySelector(".player-wrapper");if(!l)return;const s=new T({container:l,url:e,type:"m3u8",customType:{m3u8:J},volume:.5,isLive:!1,muted:!1,autoplay:!0,hotkey:!0,pip:!0,autoSize:!0,autoMini:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,theme:"#23ade5",lang:"zh-cn",moreVideoAttr:{crossOrigin:"anonymous",preload:"auto"},icons:{loading:"加载中，知道你很急，但是你先别急..."},plugins:[j({html:'<img src="https://cdn.lookimage.live/assets/img/video_ads-989f688b.png" style="max-width: 55%; height: auto;">',url:"https://www.profitablecpmrate.com/esayrydd5?key=76d97011d161ef42efe0d75ec211c794",playDuration:5,totalDuration:10,i18n:{close:"关闭广告",countdown:"%s秒",detail:"查看详情",canBeClosed:"%s秒后可关闭广告"}})]});B.value=s;let o=!1;s.on("video:timeupdate",(()=>{!o&&s.currentTime>=300&&void 0===a&&Number(m.params.source)>=6&&(o=!0,s.pause(),f.value=!0,s.on("video:play",(()=>{s.pause(),f.value=!0})))})),s.on("error",(()=>{s.notice.show="视频加载失败，请稍后重试"})),s.on("ready",(()=>{}))}))}function Q(){f.value=!1}return C((()=>{!async function(){try{const e=await N(Number(m.params.source),m.params.id);0===e.code&&e.data.length>0&&(_.value=e.data[0],I.value.itemCount=_.value.vod_play_urls.length,_.value.vod_play_urls.length>0&&(k.value=_.value.vod_play_urls[0].play_url,x.value=0,z((()=>{$(k.value)}))))}catch(e){}finally{g.value=!1}}()})),o((()=>{B.value&&(B.value.destroy(),B.value=null)})),(e,a)=>{var l;return w(),t("div",Me,[i(p)?(w(),n(q,{key:0})):u("",!0),c("main",Te,[c("div",je,[c("div",Re,[k.value?(w(),t("div",He)):u("",!0),_.value?(w(),t("div",Oe,[v(i(F),null,{default:d((()=>[c("div",Ie,[c("div",Ke,[v(i(A),{src:_.value.vod_pic,alt:_.value.vod_name,class:"movie-cover","preview-disabled":"","object-fit":"cover"},null,8,["src","alt"])]),c("div",Ne,[c("h1",null,b(_.value.vod_name),1),v(i(E),{vertical:"",size:"small"},{default:d((()=>[c("div",Pe,[qe,c("span",null,b(_.value.type_name),1)]),c("div",De,[Le,c("span",null,b(_.value.vod_director),1)]),c("div",Be,[Je,c("span",null,b(_.value.vod_actor),1)]),i(p)?(w(),t("div",{key:0,class:r(["expandable-content",{collapsed:!O.value}])},[c("div",Ue,[c("div",$e,[Ae,c("span",null,b(_.value.vod_area),1)]),c("div",Ee,[Fe,c("span",null,b(_.value.vod_lang),1)]),c("div",Ve,[We,c("span",null,b(_.value.vod_remarks),1)]),c("div",Ge,[Qe,c("div",{class:"movie-desc",innerHTML:_.value.vod_content},null,8,Xe)])])],2)):(w(),t(h,{key:1},[c("div",Ye,[Ze,c("span",null,b(_.value.vod_area),1)]),c("div",ea,[aa,c("span",null,b(_.value.vod_lang),1)]),c("div",la,[sa,c("span",null,b(_.value.vod_remarks),1)]),c("div",oa,[ta,c("div",{class:"movie-desc",innerHTML:_.value.vod_content},null,8,ia)])],64)),i(p)?(w(),t("div",na,[v(i(U),{text:"",onClick:a[0]||(a[0]=e=>O.value=!O.value)},{default:d((()=>[S(b(O.value?"收起":"展开更多"),1)])),_:1})])):u("",!0)])),_:1})])])])),_:1})])):u("",!0),(null==(l=_.value)?void 0:l.vod_play_urls.length)?(w(),t("div",ua,[v(i(F),{title:"剧集列表"},{default:d((()=>[v(i(V),{cols:i(p)?4:8,"x-gap":8,"y-gap":8},{default:d((()=>[(w(!0),t(h,null,y(i(P),((e,a)=>(w(),n(i(W),{key:e.play_id},{default:d((()=>[v(i(U),{block:"",type:x.value===(I.value.page-1)*I.value.pageSize+a?"primary":"default",onClick:l=>function(e,a){k.value=e,x.value=a,$(e)}(e.play_url,(I.value.page-1)*I.value.pageSize+a)},{default:d((()=>[S(b(e.play_num),1)])),_:2},1032,["type","onClick"])])),_:2},1024)))),128))])),_:1},8,["cols"]),c("div",ca,[v(i(G),{page:I.value.page,"onUpdate:page":[a[1]||(a[1]=e=>I.value.page=e),D],size:i(p)?"small":"medium","item-count":I.value.itemCount,"page-size":I.value.pageSize,"show-quick-jumper":""},null,8,["page","size","item-count","page-size"])])])),_:1})])):u("",!0)])]),v(L,{visible:f.value,onCancel:Q},null,8,["visible"])])])}}}),[["__scopeId","data-v-a4a08fd5"]]),va=Object.freeze(Object.defineProperty({__proto__:null,default:ra},Symbol.toStringTag,{value:"Module"}));export{Ce as M,va as a};
