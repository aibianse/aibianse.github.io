import{g as e,d as a,v as l,e as s,H as o,n as t,u as i,c as n,q as u,p as c,J as r,a as v,w as d,Q as p,R as m,U as f,F as y,K as h,N as g,O as _,o as w,V as b,t as k,x as S,C as x,G as C,D as z,B as M,W as T,X as R,Y as j}from"./vue-vendor-fb6afcf2.js";import{e as O,_ as H,p as I,q as K}from"./common-c5d558a5.js";import{I as P,c as D,a as L}from"./image-modules-5b640a7a.js";import{j as q,h as B,i as J,D as N,r as U,E as $,p as A,v as F,x as V,s as W}from"./naive-ui-f88e5312.js";const E=e("movie",{state:()=>({searchKeyword:"",searchResults:[]}),actions:{setSearchResults(e){this.searchResults=e},setSearchKeyword(e){this.searchKeyword=e}}}),G=e=>(g("data-v-fb37c3ba"),e=e(),_(),e),Q={class:"flex flex-col w-full h-full"},X={class:"flex-1 overflow-hidden"},Y={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},Z={class:"movie-search-container"},ee={class:"search-container"},ae={class:"search-wrapper"},le={class:"search-input-wrapper"},se={key:0,class:"suggestion-section"},oe={class:"section-header"},te=G((()=>c("span",null,"搜索历史",-1))),ie=["onClick"],ne={class:"history-list"},ue={class:"history-grid"},ce=["onClick"],re={class:"history-text"},ve={class:"source-tag"},de=["onClick"],pe={class:"suggestion-section"},me=G((()=>c("div",{class:"section-header"},[c("span",null,"热搜榜")],-1))),fe={class:"hot-search-list"},ye=["onClick"],he={class:"hot-text"},ge={class:"results-container"},_e=["onClick"],we={class:"movie-image"},be={class:"movie-info"},ke={class:"type-tag"},Se=L(a({__name:"MovieSearch",setup(e){const{isMobile:a}=O(),g=x(),_=E(),C=l(_.searchKeyword),z=s((()=>_.searchResults)),M=l(!1),T=l([{label:"数据源一",value:"1"},{label:"数据源二",value:"2"},{label:"数据源三",value:"3"},{label:"数据源四",value:"4"},{label:"数据源五",value:"5"}]),R=l("1"),j=l([]),K=l(!1),L=l([{text:"娼年",tag:"热"},{text:"回复术士的重来人生",tag:"R18"},{text:"无良公会",tag:"新"}]),$=l(!1);let A=null;const F=l(!1);function V(){A&&(clearTimeout(A),A=null),$.value=!0}function W(){A=setTimeout((()=>{F.value||($.value=!1)}),200)}function G(){A&&(clearTimeout(A),A=null)}function Se(){W()}o((()=>{A&&(clearTimeout(A),A=null)}));try{const e=localStorage.getItem("movieSearchHistory");e&&(j.value=JSON.parse(e))}catch(Me){j.value=[]}async function xe(e){e&&(C.value=e),$.value=!1;const a=e||C.value;if(a.trim()){K.value=!1,M.value=!0;try{const e=await I(a,R.value);0===e.code&&(_.setSearchResults(e.data),_.setSearchKeyword(a),function(e){if(!e.trim())return;const a={keyword:e.trim(),source:R.value,timestamp:Date.now()};j.value=j.value.filter((e=>!(e.keyword===a.keyword&&e.source===a.source))),j.value.unshift(a),j.value.length>10&&j.value.pop(),localStorage.setItem("movieSearchHistory",JSON.stringify(j.value))}(a))}catch(l){}finally{M.value=!1}}}function Ce(){j.value=[],localStorage.removeItem("movieSearchHistory")}function ze(e){switch(e){case"热":case"R18":return"hot";case"新":return"new";case"直播中":return"live";default:return""}}return o((()=>{_.setSearchKeyword(C.value)})),(e,l)=>(w(),t("div",Q,[i(a)?(w(),n(D,{key:0})):u("",!0),c("main",X,[c("div",Y,[c("div",{id:"movie-wrapper",class:r(["w-full max-w-screen-xl m-auto",[i(a)?"p-2":"p-4"]])},[c("div",Z,[c("div",ee,[c("div",ae,[c("div",le,[v(i(N),null,{default:d((()=>[v(i(q),{value:R.value,"onUpdate:value":l[0]||(l[0]=e=>R.value=e),style:{width:"30%"},"default-value":R.value,options:T.value,size:"large",placeholder:"数据源"},null,8,["value","default-value","options"]),v(i(B),{value:C.value,"onUpdate:value":l[2]||(l[2]=e=>C.value=e),style:{width:"70%"},size:"large",type:"text",placeholder:"影视名称关键字",clearable:"",loading:M.value,onKeyup:l[3]||(l[3]=b((e=>xe()),["enter"])),onFocus:V,onBlur:W},{suffix:d((()=>[v(i(J),{disabled:M.value,secondary:"",onClick:l[1]||(l[1]=e=>xe())},{icon:d((()=>[v(i(H),{icon:i(P).nav.search,class:"search-icon"},null,8,["icon"])])),_:1},8,["disabled"])])),_:1},8,["value","loading"])])),_:1})]),p(c("div",{class:"search-suggestions",onMouseenter:G,onMouseleave:Se},[j.value.length>0?(w(),t("div",se,[c("div",oe,[te,c("span",{class:"clear-history",onClick:f(Ce,["stop"])},"清空",8,ie)]),c("div",ne,[c("div",ue,[(w(!0),t(y,null,h(j.value,((e,a)=>{var l;return w(),t("div",{key:`history-${a}`,class:"history-item",onClick:a=>async function(e){R.value=e.source,await xe(e.keyword)}(e)},[c("span",re,[c("span",ve,"["+k(null==(l=T.value.find((a=>a.value===e.source)))?void 0:l.label)+"]",1),S(" "+k(e.keyword),1)]),c("span",{class:"delete-icon",onClick:f((e=>function(e){F.value=!0,j.value.splice(e,1),localStorage.setItem("movieSearchHistory",JSON.stringify(j.value)),setTimeout((()=>{F.value=!1}),300)}(a)),["stop","prevent"])},"×",8,de)],8,ce)})),128))])])])):u("",!0),c("div",pe,[me,c("div",fe,[(w(!0),t(y,null,h(L.value,((e,a)=>(w(),t("div",{key:`hot-${a}`,class:"suggestion-item",onClick:a=>xe(e.text)},[c("span",{class:r(["hot-rank",{"top-3":a<3}])},k(a+1),3),c("span",he,k(e.text),1),e.tag?(w(),t("span",{key:0,class:r(["hot-tag",ze(e.tag)])},k(e.tag),3)):u("",!0)],8,ye)))),128))])])],544),[[m,$.value]])])]),c("div",ge,[(w(!0),t(y,null,h(i(z),(e=>(w(),t("div",{key:e.vod_id,class:"movie-card",onClick:a=>i(g).push(`/movie/movie-detail/${R.value}/${e.vod_id}`)},[c("div",we,[v(i(U),{lazy:"",src:e.vod_pic,alt:e.vod_name,"preview-disabled":"","object-fit":"cover","intersection-observer-options":{root:"#scrollRef",rootMargin:"200px 0px",threshold:.1}},null,8,["src","alt","intersection-observer-options"])]),c("div",be,[c("h3",null,k(e.vod_name),1),c("span",ke,k(e.type_name),1)])],8,_e)))),128))])])],2)])])]))}}),[["__scopeId","data-v-fb37c3ba"]]),xe=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),Ce=e=>(g("data-v-52a8ae1a"),e=e(),_(),e),ze={class:"flex flex-col w-full h-full"},Me={class:"flex-1 overflow-hidden"},Te={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},Re={class:"movie-detail-container"},je={key:0,class:"player-wrapper"},Oe={key:1,class:"info-section"},He={class:"movie-header"},Ie={class:"movie-cover-wrapper"},Ke={class:"movie-info"},Pe={class:"info-item"},De=Ce((()=>c("span",{class:"label"},"类型：",-1))),Le={class:"info-item"},qe=Ce((()=>c("span",{class:"label"},"导演：",-1))),Be={class:"info-item"},Je=Ce((()=>c("span",{class:"label"},"主演：",-1))),Ne={class:"info-items"},Ue={class:"info-item"},$e=Ce((()=>c("span",{class:"label"},"地区：",-1))),Ae={class:"info-item"},Fe=Ce((()=>c("span",{class:"label"},"语言：",-1))),Ve={class:"info-item"},We=Ce((()=>c("span",{class:"label"},"状态：",-1))),Ee={class:"info-item"},Ge=Ce((()=>c("span",{class:"label"},"简介：",-1))),Qe=["innerHTML"],Xe={class:"info-item"},Ye=Ce((()=>c("span",{class:"label"},"地区：",-1))),Ze={class:"info-item"},ea=Ce((()=>c("span",{class:"label"},"语言：",-1))),aa={class:"info-item"},la=Ce((()=>c("span",{class:"label"},"状态：",-1))),sa={class:"info-item"},oa=Ce((()=>c("span",{class:"label"},"简介：",-1))),ta=["innerHTML"],ia={key:2,class:"expand-more"},na={key:2,class:"episodes-section"},ua={class:"pagination-wrapper"},ca=L(a({__name:"MovieDetail",setup(e){const{isMobile:a}=O(),p=M(),m=l(!0),f=l(null),g=l(""),_=l(0),b=l(!1),x=l({page:1,pageSize:20,itemCount:0}),H=s((()=>{var e;if(!(null==(e=f.value)?void 0:e.vod_play_urls))return[];const a=(x.value.page-1)*x.value.pageSize,l=a+x.value.pageSize;return f.value.vod_play_urls.slice(a,l)}));function I(e){x.value.page=e,window.scrollTo({top:0,behavior:"smooth"})}const P=l(null);function L(e,a,l){if(j.isSupported()){l.hls&&l.hls.destroy();const s=new j;s.loadSource(a),s.attachMedia(e),l.hls=s,l.on("destroy",(()=>s.destroy()))}else e.canPlayType("application/vnd.apple.mpegurl")?e.src=a:l.notice.show="不支持的播放格式：m3u8"}function q(e){P.value&&(P.value.destroy(),P.value=null),z((()=>{const a=document.querySelector(".player-wrapper");a&&(P.value=new T({container:a,url:e,type:"m3u8",customType:{m3u8:L},volume:.5,isLive:!1,muted:!1,autoplay:!0,hotkey:!0,pip:!0,autoSize:!0,autoMini:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,theme:"#23ade5",lang:"zh-cn",moreVideoAttr:{crossOrigin:"anonymous",preload:"auto"},settings:[{width:200,html:"字幕",tooltip:"双语",selector:[{html:"显示",tooltip:"显示",switch:!0,onSwitch:e=>(e.tooltip=e.switch?"隐藏":"显示",P.value&&(P.value.subtitle.show=!e.switch),!e.switch)}]}],contextmenu:[{html:"播放器信息",click(e){e.show=!1}}],icons:{loading:"加载中，知道你很急，但是你先别急..."},plugins:[R({html:'<img src="https://cdn.lookimage.live/assets/img/video_ads-989f688b.png">',url:"https://www.profitablecpmrate.com/esayrydd5?key=76d97011d161ef42efe0d75ec211c794",playDuration:5,totalDuration:10,i18n:{close:"关闭广告",countdown:"%s秒",detail:"查看详情",canBeClosed:"%s秒后可关闭广告"}})]}),P.value&&(P.value.on("error",(()=>{})),P.value.on("ready",(()=>{})),P.value.on("artplayerPluginAds:click",(e=>{})),P.value.on("artplayerPluginAds:skip",(e=>{}))))}))}return C((()=>{!async function(){try{const e=await K(p.params.source,p.params.id);0===e.code&&e.data.length>0&&(f.value=e.data[0],x.value.itemCount=f.value.vod_play_urls.length,f.value.vod_play_urls.length>0&&(g.value=f.value.vod_play_urls[0].play_url,_.value=0,z((()=>{q(g.value)}))))}catch(e){}finally{m.value=!1}}()})),o((()=>{P.value&&(P.value.destroy(),P.value=null)})),(e,l)=>{var s;return w(),t("div",ze,[i(a)?(w(),n(D,{key:0})):u("",!0),c("main",Me,[c("div",Te,[c("div",Re,[g.value?(w(),t("div",je)):u("",!0),f.value?(w(),t("div",Oe,[v(i(A),null,{default:d((()=>[c("div",He,[c("div",Ie,[v(i(U),{src:f.value.vod_pic,alt:f.value.vod_name,class:"movie-cover","preview-disabled":"","object-fit":"cover"},null,8,["src","alt"])]),c("div",Ke,[c("h1",null,k(f.value.vod_name),1),v(i($),{vertical:"",size:"small"},{default:d((()=>[c("div",Pe,[De,c("span",null,k(f.value.type_name),1)]),c("div",Le,[qe,c("span",null,k(f.value.vod_director),1)]),c("div",Be,[Je,c("span",null,k(f.value.vod_actor),1)]),i(a)?(w(),t("div",{key:0,class:r(["expandable-content",{collapsed:!b.value}])},[c("div",Ne,[c("div",Ue,[$e,c("span",null,k(f.value.vod_area),1)]),c("div",Ae,[Fe,c("span",null,k(f.value.vod_lang),1)]),c("div",Ve,[We,c("span",null,k(f.value.vod_remarks),1)]),c("div",Ee,[Ge,c("div",{class:"movie-desc",innerHTML:f.value.vod_content},null,8,Qe)])])],2)):(w(),t(y,{key:1},[c("div",Xe,[Ye,c("span",null,k(f.value.vod_area),1)]),c("div",Ze,[ea,c("span",null,k(f.value.vod_lang),1)]),c("div",aa,[la,c("span",null,k(f.value.vod_remarks),1)]),c("div",sa,[oa,c("div",{class:"movie-desc",innerHTML:f.value.vod_content},null,8,ta)])],64)),i(a)?(w(),t("div",ia,[v(i(J),{text:"",onClick:l[0]||(l[0]=e=>b.value=!b.value)},{default:d((()=>[S(k(b.value?"收起":"展开更多"),1)])),_:1})])):u("",!0)])),_:1})])])])),_:1})])):u("",!0),(null==(s=f.value)?void 0:s.vod_play_urls.length)?(w(),t("div",na,[v(i(A),{title:"剧集列表"},{default:d((()=>[v(i(F),{cols:i(a)?4:8,"x-gap":8,"y-gap":8},{default:d((()=>[(w(!0),t(y,null,h(i(H),((e,a)=>(w(),n(i(V),{key:e.play_id},{default:d((()=>[v(i(J),{block:"",type:_.value===(x.value.page-1)*x.value.pageSize+a?"primary":"default",onClick:l=>function(e,a){g.value=e,_.value=a,q(e)}(e.play_url,(x.value.page-1)*x.value.pageSize+a)},{default:d((()=>[S(k(e.play_num),1)])),_:2},1032,["type","onClick"])])),_:2},1024)))),128))])),_:1},8,["cols"]),c("div",ua,[v(i(W),{page:x.value.page,"onUpdate:page":[l[1]||(l[1]=e=>x.value.page=e),I],size:i(a)?"small":"medium","item-count":x.value.itemCount,"page-size":x.value.pageSize,"show-quick-jumper":""},null,8,["page","size","item-count","page-size"])])])),_:1})])):u("",!0)])])])])}}}),[["__scopeId","data-v-52a8ae1a"]]),ra=Object.freeze(Object.defineProperty({__proto__:null,default:ca},Symbol.toStringTag,{value:"Module"}));export{xe as M,ra as a};
