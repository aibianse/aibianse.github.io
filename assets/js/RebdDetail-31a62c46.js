import{d as e,v as a,e as l,E as s,G as i,n as u,u as o,c as n,q as v,p as t,a as r,w as c,C as d,A as p,W as m,X as f,o as y,t as _,H as g,x as b,F as h,J as k,M as w,N as x}from"./vue-vendor-ca37f3ab.js";import{c as M,e as T,D as C}from"./common-8c4f62e8.js";import{c as z,b as j,a as H}from"./image-modules-54f63cac.js";import{E as L,i as S,p as W,q as A,v as R,x as q}from"./naive-ui-5b39965d.js";import"./utils-f1e0c1c0.js";import"./layout-087772db.js";const N=e=>(w("data-v-331295f4"),e=e(),x(),e),P={class:"flex flex-col w-full h-full"},D={class:"flex-1 overflow-hidden"},E={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},G={class:"movie-detail-container"},I={key:0,class:"player-wrapper"},K={key:1,class:"info-section"},O={class:"movie-header"},B={class:"movie-info"},F={class:"info-item"},J=N((()=>t("span",{class:"label"},"品番：",-1))),U={class:"value"},V={class:"info-item"},X=N((()=>t("span",{class:"label"},"出演者：",-1))),Q={class:"value"},Y={class:"info-item"},Z=N((()=>t("span",{class:"label"},"导演：",-1))),$={class:"value"},ee={class:"info-item"},ae=N((()=>t("span",{class:"label"},"发布日期：",-1))),le={class:"value"},se={class:"info-item"},ie=N((()=>t("span",{class:"label"},"制造商：",-1))),ue={class:"value"},oe={class:"info-item"},ne=N((()=>t("span",{class:"label"},"时长：",-1))),ve={class:"value"},te=N((()=>t("br",null,null,-1))),re={class:"info-items"},ce={class:"info-item"},de=["innerHTML"],pe={key:1,class:"info-item"},me=["innerHTML"],fe={key:2,class:"expand-more"},ye={key:2,class:"episodes-section"},_e={key:3,class:"episodes-section"},ge=H(e({__name:"RebdDetail",setup(e){const w=M().token,{isMobile:x}=T(),H=p(),N=a(!1),ge=a(!0),be=a(null),he=a(""),ke=a(0),we=a(!1),xe=a({page:1,pageSize:20,itemCount:0}),Me=l((()=>{var e;if(!(null==(e=be.value)?void 0:e.vod_play_urls))return[];const a=(xe.value.page-1)*xe.value.pageSize,l=a+xe.value.pageSize;return be.value.vod_play_urls.slice(a,l)})),Te=a(null);function Ce(e,a,l){e.canPlayType("video/mp4")?e.src=a:l.notice.show="不支持的播放格式：mp4"}function ze(e){Te.value&&(Te.value.destroy(),Te.value=null),d((()=>{var a;const l=document.querySelector(".player-wrapper");if(!l)return;const s=new m({container:l,url:e,type:"video/mp4",customType:{mp4:Ce},poster:null==(a=be.value)?void 0:a.cover_image_url,volume:.5,isLive:!1,muted:!1,autoplay:!1,hotkey:!0,pip:!0,autoSize:!0,autoMini:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,theme:"#23ade5",lang:"zh-cn",moreVideoAttr:{crossOrigin:"anonymous",preload:"auto"},icons:{loading:"加载中，知道你很急，但是你先别急..."},headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36"},plugins:[f({})]});Te.value=s;let i=!1;s.on("video:timeupdate",(()=>{!i&&s.currentTime>=300&&void 0===w&&Number(H.params.source)>=6&&(i=!0,s.pause(),N.value=!0,s.on("video:play",(()=>{s.pause(),N.value=!0})))})),s.on("error",(()=>{s.notice.show="视频加载失败，请稍后重试"})),s.on("ready",(()=>{}))}))}function je(){N.value=!1}return s((()=>{!async function(){try{const e=await C(H.params.code);0===e.code&&e.data.length>0&&(be.value=e.data[0],be.value.preview_image_url.unshift(be.value.cover_image_url),xe.value.itemCount=be.value.vod_play_urls.length,be.value.vod_play_urls.length>0&&(he.value=be.value.vod_play_urls[0].play_url,ke.value=0,d((()=>{ze(he.value)}))))}catch(e){}finally{ge.value=!1}}()})),i((()=>{Te.value&&(Te.value.destroy(),Te.value=null)})),(e,a)=>{var l,s;return y(),u("div",P,[o(x)?(y(),n(j,{key:0})):v("",!0),t("main",D,[t("div",E,[t("div",G,[he.value?(y(),u("div",I)):v("",!0),be.value?(y(),u("div",K,[r(o(W),null,{default:c((()=>[t("div",O,[t("div",B,[t("h1",null,_(be.value.name),1),r(o(L),{vertical:"",size:"small"},{default:c((()=>[t("div",F,[J,t("span",U,_(be.value.code),1)]),t("div",V,[X,t("span",Q,_(be.value.actor),1)]),t("div",Y,[Z,t("span",$,_(be.value.director),1)]),t("div",ee,[ae,t("span",le,_(be.value.publish_time),1)]),t("div",se,[ie,t("span",ue,_(be.value.manufacturer),1)]),t("div",oe,[ne,t("span",ve,_(be.value.video_length)+"分钟",1)]),te,o(x)?(y(),u("div",{key:0,class:g(["expandable-content",{collapsed:!we.value}])},[t("div",re,[t("div",ce,[t("div",{class:"value movie-desc",innerHTML:be.value.description},null,8,de)])])],2)):(y(),u("div",pe,[t("div",{class:"value movie-desc",innerHTML:be.value.description},null,8,me)])),o(x)?(y(),u("div",fe,[r(o(S),{text:"",onClick:a[0]||(a[0]=e=>we.value=!we.value)},{default:c((()=>[b(_(we.value?"收起":"展开描述"),1)])),_:1})])):v("",!0)])),_:1})])])])),_:1})])):v("",!0),(null==(l=be.value)?void 0:l.preview_image_url.length)?(y(),u("div",ye,[r(o(W),{title:"预览图片"},{default:c((()=>[(y(!0),u(h,null,k(be.value.preview_image_url,((e,a)=>(y(),n(o(A),{key:a,class:"preview-img",src:e},null,8,["src"])))),128))])),_:1})])):v("",!0),(null==(s=be.value)?void 0:s.vod_play_urls.length)?(y(),u("div",_e,[r(o(W),{title:"播放列表"},{default:c((()=>[r(o(R),{cols:o(x)?4:8,"x-gap":8,"y-gap":8},{default:c((()=>[(y(!0),u(h,null,k(o(Me),((e,a)=>(y(),n(o(q),{key:a},{default:c((()=>[r(o(S),{block:"",disabled:null===e.play_url,onClick:a=>{return l=e.play_url,he.value=l,void ze(l);var l}},{default:c((()=>[b(_(0===a?"预览":null!==e.play_url&&void 0!==e.play_url?"正片":"暂无"),1)])),_:2},1032,["disabled","onClick"])])),_:2},1024)))),128))])),_:1},8,["cols"])])),_:1})])):v("",!0)])]),r(z,{visible:N.value,onCancel:je},null,8,["visible"])])])}}}),[["__scopeId","data-v-331295f4"]]);export{ge as default};
