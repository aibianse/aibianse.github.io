import{g as e,d as a,v as l,e as s,J as o,n as t,u as i,c as n,q as u,p as c,y as v,a as r,w as d,O as p,P as m,S as f,F as y,z as h,L as g,M as _,o as w,T as b,t as k,x as S,G as x,A as z,H as C,E as M,U as T,V as R}from"./vue-vendor-12459f3a.js";import{b as j,_ as O,m as H,n as I}from"./common-37302176.js";import{I as K,b as L,_ as P}from"./image-modules-9a32fa68.js";import{k as J,h as U,i as $,L as q,y as B,x as D,w as N,B as A,D as F,z as V}from"./naive-ui-832a6a86.js";const E=e("movie",{state:()=>({searchKeyword:"",searchResults:[]}),actions:{setSearchResults(e){this.searchResults=e},setSearchKeyword(e){this.searchKeyword=e}}}),G=e=>(g("data-v-fb37c3ba"),e=e(),_(),e),W={class:"flex flex-col w-full h-full"},Q={class:"flex-1 overflow-hidden"},X={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},Y={class:"movie-search-container"},Z={class:"search-container"},ee={class:"search-wrapper"},ae={class:"search-input-wrapper"},le={key:0,class:"suggestion-section"},se={class:"section-header"},oe=G((()=>c("span",null,"搜索历史",-1))),te=["onClick"],ie={class:"history-list"},ne={class:"history-grid"},ue=["onClick"],ce={class:"history-text"},ve={class:"source-tag"},re=["onClick"],de={class:"suggestion-section"},pe=G((()=>c("div",{class:"section-header"},[c("span",null,"热搜榜")],-1))),me={class:"hot-search-list"},fe=["onClick"],ye={class:"hot-text"},he={class:"results-container"},ge=["onClick"],_e={class:"movie-image"},we={class:"movie-info"},be={class:"type-tag"},ke=P(a({__name:"MovieSearch",setup(e){const{isMobile:a}=j(),g=x(),_=E(),z=l(_.searchKeyword),C=s((()=>_.searchResults)),M=l(!1),T=l([{label:"数据源一",value:"1"},{label:"数据源二",value:"2"},{label:"数据源三",value:"3"},{label:"数据源四",value:"4"},{label:"数据源五",value:"5"}]),R=l("1"),I=l([]),P=l(!1),D=l([{text:"娼年",tag:"热"},{text:"回复术士的重来人生",tag:"R18"},{text:"无良公会",tag:"新"}]),N=l(!1);let A=null;const F=l(!1);function V(){A&&(clearTimeout(A),A=null),N.value=!0}function G(){A=setTimeout((()=>{F.value||(N.value=!1)}),200)}function ke(){A&&(clearTimeout(A),A=null)}function Se(){G()}o((()=>{A&&(clearTimeout(A),A=null)}));try{const e=localStorage.getItem("movieSearchHistory");e&&(I.value=JSON.parse(e))}catch(Me){I.value=[]}async function xe(e){e&&(z.value=e),N.value=!1;const a=e||z.value;if(a.trim()){P.value=!1,M.value=!0;try{const e=await H(a,R.value);0===e.code&&(_.setSearchResults(e.data),_.setSearchKeyword(a),function(e){if(!e.trim())return;const a={keyword:e.trim(),source:R.value,timestamp:Date.now()};I.value=I.value.filter((e=>!(e.keyword===a.keyword&&e.source===a.source))),I.value.unshift(a),I.value.length>10&&I.value.pop(),localStorage.setItem("movieSearchHistory",JSON.stringify(I.value))}(a))}catch(l){}finally{M.value=!1}}}function ze(){I.value=[],localStorage.removeItem("movieSearchHistory")}function Ce(e){switch(e){case"热":case"R18":return"hot";case"新":return"new";case"直播中":return"live";default:return""}}return o((()=>{_.setSearchKeyword(z.value)})),(e,l)=>(w(),t("div",W,[i(a)?(w(),n(L,{key:0})):u("",!0),c("main",Q,[c("div",X,[c("div",{id:"movie-wrapper",class:v(["w-full max-w-screen-xl m-auto",[i(a)?"p-2":"p-4"]])},[c("div",Y,[c("div",Z,[c("div",ee,[c("div",ae,[r(i(q),null,{default:d((()=>[r(i(J),{value:R.value,"onUpdate:value":l[0]||(l[0]=e=>R.value=e),style:{width:"30%"},"default-value":R.value,options:T.value,size:"large",placeholder:"数据源"},null,8,["value","default-value","options"]),r(i(U),{value:z.value,"onUpdate:value":l[2]||(l[2]=e=>z.value=e),style:{width:"70%"},size:"large",type:"text",placeholder:"影视名称关键字",clearable:"",loading:M.value,onKeyup:l[3]||(l[3]=b((e=>xe()),["enter"])),onFocus:V,onBlur:G},{suffix:d((()=>[r(i($),{disabled:M.value,secondary:"",onClick:l[1]||(l[1]=e=>xe())},{icon:d((()=>[r(i(O),{icon:i(K).nav.search,class:"search-icon"},null,8,["icon"])])),_:1},8,["disabled"])])),_:1},8,["value","loading"])])),_:1})]),p(c("div",{class:"search-suggestions",onMouseenter:ke,onMouseleave:Se},[I.value.length>0?(w(),t("div",le,[c("div",se,[oe,c("span",{class:"clear-history",onClick:f(ze,["stop"])},"清空",8,te)]),c("div",ie,[c("div",ne,[(w(!0),t(y,null,h(I.value,((e,a)=>{var l;return w(),t("div",{key:`history-${a}`,class:"history-item",onClick:a=>async function(e){R.value=e.source,await xe(e.keyword)}(e)},[c("span",ce,[c("span",ve,"["+k(null==(l=T.value.find((a=>a.value===e.source)))?void 0:l.label)+"]",1),S(" "+k(e.keyword),1)]),c("span",{class:"delete-icon",onClick:f((e=>function(e){F.value=!0,I.value.splice(e,1),localStorage.setItem("movieSearchHistory",JSON.stringify(I.value)),setTimeout((()=>{F.value=!1}),300)}(a)),["stop","prevent"])},"×",8,re)],8,ue)})),128))])])])):u("",!0),c("div",de,[pe,c("div",me,[(w(!0),t(y,null,h(D.value,((e,a)=>(w(),t("div",{key:`hot-${a}`,class:"suggestion-item",onClick:a=>xe(e.text)},[c("span",{class:v(["hot-rank",{"top-3":a<3}])},k(a+1),3),c("span",ye,k(e.text),1),e.tag?(w(),t("span",{key:0,class:v(["hot-tag",Ce(e.tag)])},k(e.tag),3)):u("",!0)],8,fe)))),128))])])],544),[[m,N.value]])])]),c("div",he,[(w(!0),t(y,null,h(i(C),(e=>(w(),t("div",{key:e.vod_id,class:"movie-card",onClick:a=>i(g).push(`/movie/movie-detail/${R.value}/${e.vod_id}`)},[c("div",_e,[r(i(B),{lazy:"",src:e.vod_pic,alt:e.vod_name,"preview-disabled":"","object-fit":"cover","intersection-observer-options":{root:"#scrollRef",rootMargin:"200px 0px",threshold:.1}},null,8,["src","alt","intersection-observer-options"])]),c("div",we,[c("h3",null,k(e.vod_name),1),c("span",be,k(e.type_name),1)])],8,ge)))),128))])])],2)])])]))}}),[["__scopeId","data-v-fb37c3ba"]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"})),xe=e=>(g("data-v-6160f346"),e=e(),_(),e),ze={class:"flex flex-col w-full h-full"},Ce={class:"flex-1 overflow-hidden"},Me={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},Te={class:"movie-detail-container"},Re={key:0,class:"player-wrapper"},je={key:1,class:"info-section"},Oe={class:"movie-header"},He={class:"movie-cover-wrapper"},Ie={class:"movie-info"},Ke={class:"info-item"},Le=xe((()=>c("span",{class:"label"},"类型：",-1))),Pe={class:"info-item"},Je=xe((()=>c("span",{class:"label"},"导演：",-1))),Ue={class:"info-item"},$e=xe((()=>c("span",{class:"label"},"主演：",-1))),qe={class:"info-items"},Be={class:"info-item"},De=xe((()=>c("span",{class:"label"},"地区：",-1))),Ne={class:"info-item"},Ae=xe((()=>c("span",{class:"label"},"语言：",-1))),Fe={class:"info-item"},Ve=xe((()=>c("span",{class:"label"},"状态：",-1))),Ee={class:"info-item"},Ge=xe((()=>c("span",{class:"label"},"简介：",-1))),We=["innerHTML"],Qe={class:"info-item"},Xe=xe((()=>c("span",{class:"label"},"地区：",-1))),Ye={class:"info-item"},Ze=xe((()=>c("span",{class:"label"},"语言：",-1))),ea={class:"info-item"},aa=xe((()=>c("span",{class:"label"},"状态：",-1))),la={class:"info-item"},sa=xe((()=>c("span",{class:"label"},"简介：",-1))),oa=["innerHTML"],ta={key:2,class:"expand-more"},ia={key:2,class:"episodes-section"},na={class:"pagination-wrapper"},ua=P(a({__name:"MovieDetail",setup(e){const{isMobile:a}=j(),p=M(),m=l(!0),f=l(null),g=l(""),_=l(0),b=l(!1),x=l({page:1,pageSize:20,itemCount:0}),O=s((()=>{var e;if(!(null==(e=f.value)?void 0:e.vod_play_urls))return[];const a=(x.value.page-1)*x.value.pageSize,l=a+x.value.pageSize;return f.value.vod_play_urls.slice(a,l)}));function H(e){x.value.page=e,window.scrollTo({top:0,behavior:"smooth"})}const K=l(null);function P(e,a,l){if(R.isSupported()){l.hls&&l.hls.destroy();const s=new R;s.loadSource(a),s.attachMedia(e),l.hls=s,l.on("destroy",(()=>s.destroy()))}else e.canPlayType("application/vnd.apple.mpegurl")?e.src=a:l.notice.show="不支持的播放格式：m3u8"}function J(e){K.value&&(K.value.destroy(),K.value=null),C((()=>{const a=document.querySelector(".player-wrapper");a&&(K.value=new T({container:a,url:e,type:"m3u8",customType:{m3u8:P},volume:.5,isLive:!1,muted:!1,autoplay:!0,hotkey:!0,pip:!0,autoSize:!0,autoMini:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,theme:"#23ade5",lang:"zh-cn",moreVideoAttr:{crossOrigin:"anonymous",preload:"auto"},settings:[{width:200,html:"字幕",tooltip:"双语",selector:[{html:"显示",tooltip:"显示",switch:!0,onSwitch:e=>(e.tooltip=e.switch?"隐藏":"显示",K.value&&(K.value.subtitle.show=!e.switch),!e.switch)}]}],contextmenu:[{html:"播放器信息",click(e){e.show=!1}}],icons:{loading:"加载中，知道你很急，但是你先别急..."}}),K.value&&(K.value.on("error",(()=>{})),K.value.on("ready",(()=>{}))))}))}return z((()=>{!async function(){try{const e=await I(p.params.source,p.params.id);0===e.code&&e.data.length>0&&(f.value=e.data[0],x.value.itemCount=f.value.vod_play_urls.length,f.value.vod_play_urls.length>0&&(g.value=f.value.vod_play_urls[0].play_url,_.value=0,C((()=>{J(g.value)}))))}catch(e){}finally{m.value=!1}}()})),o((()=>{K.value&&(K.value.destroy(),K.value=null)})),(e,l)=>{var s;return w(),t("div",ze,[i(a)?(w(),n(L,{key:0})):u("",!0),c("main",Ce,[c("div",Me,[c("div",Te,[g.value?(w(),t("div",Re)):u("",!0),f.value?(w(),t("div",je,[r(i(N),null,{default:d((()=>[c("div",Oe,[c("div",He,[r(i(B),{src:f.value.vod_pic,alt:f.value.vod_name,class:"movie-cover","preview-disabled":"","object-fit":"cover"},null,8,["src","alt"])]),c("div",Ie,[c("h1",null,k(f.value.vod_name),1),r(i(D),{vertical:"",size:"small"},{default:d((()=>[c("div",Ke,[Le,c("span",null,k(f.value.type_name),1)]),c("div",Pe,[Je,c("span",null,k(f.value.vod_director),1)]),c("div",Ue,[$e,c("span",null,k(f.value.vod_actor),1)]),i(a)?(w(),t("div",{key:0,class:v(["expandable-content",{collapsed:!b.value}])},[c("div",qe,[c("div",Be,[De,c("span",null,k(f.value.vod_area),1)]),c("div",Ne,[Ae,c("span",null,k(f.value.vod_lang),1)]),c("div",Fe,[Ve,c("span",null,k(f.value.vod_remarks),1)]),c("div",Ee,[Ge,c("div",{class:"movie-desc",innerHTML:f.value.vod_content},null,8,We)])])],2)):(w(),t(y,{key:1},[c("div",Qe,[Xe,c("span",null,k(f.value.vod_area),1)]),c("div",Ye,[Ze,c("span",null,k(f.value.vod_lang),1)]),c("div",ea,[aa,c("span",null,k(f.value.vod_remarks),1)]),c("div",la,[sa,c("div",{class:"movie-desc",innerHTML:f.value.vod_content},null,8,oa)])],64)),i(a)?(w(),t("div",ta,[r(i($),{text:"",onClick:l[0]||(l[0]=e=>b.value=!b.value)},{default:d((()=>[S(k(b.value?"收起":"展开更多"),1)])),_:1})])):u("",!0)])),_:1})])])])),_:1})])):u("",!0),(null==(s=f.value)?void 0:s.vod_play_urls.length)?(w(),t("div",ia,[r(i(N),{title:"剧集列表"},{default:d((()=>[r(i(A),{cols:i(a)?4:8,"x-gap":8,"y-gap":8},{default:d((()=>[(w(!0),t(y,null,h(i(O),((e,a)=>(w(),n(i(F),{key:e.play_id},{default:d((()=>[r(i($),{block:"",type:_.value===(x.value.page-1)*x.value.pageSize+a?"primary":"default",onClick:l=>function(e,a){g.value=e,_.value=a,J(e)}(e.play_url,(x.value.page-1)*x.value.pageSize+a)},{default:d((()=>[S(k(e.play_num),1)])),_:2},1032,["type","onClick"])])),_:2},1024)))),128))])),_:1},8,["cols"]),c("div",na,[r(i(V),{page:x.value.page,"onUpdate:page":[l[1]||(l[1]=e=>x.value.page=e),H],size:i(a)?"small":"medium","item-count":x.value.itemCount,"page-size":x.value.pageSize,"show-quick-jumper":""},null,8,["page","size","item-count","page-size"])])])),_:1})])):u("",!0)])])])])}}}),[["__scopeId","data-v-6160f346"]]),ca=Object.freeze(Object.defineProperty({__proto__:null,default:ua},Symbol.toStringTag,{value:"Module"}));export{Se as M,ca as a};
