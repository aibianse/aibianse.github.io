import{g as e,d as a,v as l,e as s,G as o,n as t,u as i,c as n,q as u,p as c,H as r,a as v,w as d,P as p,Q as m,U as f,F as h,J as y,M as g,N as _,o as w,V as k,t as b,x as S,B as x,E as C,C as z,A as M,W as T,X as j,Y as R}from"./vue-vendor-ca37f3ab.js";import{e as H,_ as O,p as I,c as K,q as N}from"./common-af2d1236.js";import{I as P,b as q,a as D,c as L}from"./image-modules-8dab8a3d.js";import{j as $,h as B,i as J,D as U,q as A,E,p as F,v as V,x as W,s as G}from"./naive-ui-5b39965d.js";const Q=e("movie",{state:()=>({searchKeyword:"",searchResults:[],searchSource:1}),actions:{setSearchResults(e){this.searchResults=e},setSearchKeyword(e){this.searchKeyword=e},setSearchSource(e){this.searchSource=e}}}),X=e=>(g("data-v-e876726e"),e=e(),_(),e),Y={class:"flex flex-col w-full h-full"},Z={class:"flex-1 overflow-hidden"},ee={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},ae={class:"movie-search-container"},le={class:"search-container"},se={class:"search-wrapper"},oe={class:"search-input-wrapper"},te={key:0,class:"suggestion-section"},ie={class:"section-header"},ne=X((()=>c("span",null,"搜索历史",-1))),ue=["onClick"],ce={class:"history-list"},re={class:"history-grid"},ve=["onClick"],de={class:"history-text"},pe={class:"source-tag"},me=["onClick"],fe={class:"suggestion-section"},he=X((()=>c("div",{class:"section-header"},[c("span",null,"热搜榜")],-1))),ye={class:"hot-search-list"},ge=["onClick"],_e={class:"hot-text"},we={class:"results-container"},ke=["onClick"],be={class:"movie-info"},Se={class:"type-tag"},xe=D(a({__name:"MovieSearch",setup(e){const{isMobile:a}=H(),g=x(),_=Q(),C=l(_.searchKeyword),z=s((()=>_.searchResults)),M=l(_.searchSource),T=l(!1),j=l([{label:"影视源",value:1},{label:"成人源",value:2}]),R=s((()=>2===M.value)),K=l([]),N=l(!1),D=l([{text:"娼年",tag:"热"},{text:"回复术士的重来人生",tag:"R18"},{text:"无良公会",tag:"新"}]),L=l(!1);let E=null;const F=l(!1);function V(){E&&(clearTimeout(E),E=null),L.value=!0}function W(){E=setTimeout((()=>{F.value||(L.value=!1)}),200)}function G(){E&&(clearTimeout(E),E=null)}function X(){W()}o((()=>{E&&(clearTimeout(E),E=null)}));try{const e=localStorage.getItem("movieSearchHistory");e&&(K.value=JSON.parse(e))}catch(Me){K.value=[]}async function xe(e){e&&(C.value=e),L.value=!1;const a=e||C.value;if(a.trim()){N.value=!1,T.value=!0;try{const e=await I(a,M.value);0===e.code&&(_.setSearchResults(e.data),_.setSearchKeyword(a),_.setSearchSource(M.value),function(e){if(!e.trim())return;const a={keyword:e.trim(),source:M.value,timestamp:Date.now()};K.value=K.value.filter((e=>!(e.keyword===a.keyword&&e.source===a.source))),K.value.unshift(a),K.value.length>10&&K.value.pop(),localStorage.setItem("movieSearchHistory",JSON.stringify(K.value))}(a))}catch(l){}finally{T.value=!1}}}function Ce(){K.value=[],localStorage.removeItem("movieSearchHistory")}function ze(e){switch(e){case"热":case"R18":return"hot";case"新":return"new";case"直播中":return"live";default:return""}}return o((()=>{_.setSearchKeyword(C.value),_.setSearchSource(M.value)})),(e,l)=>(w(),t("div",Y,[i(a)?(w(),n(q,{key:0})):u("",!0),c("main",Z,[c("div",ee,[c("div",{id:"movie-wrapper",class:r(["w-full max-w-screen-xl m-auto",[i(a)?"p-2":"p-4"]])},[c("div",ae,[c("div",le,[c("div",se,[c("div",oe,[v(i(U),null,{default:d((()=>[v(i($),{value:M.value,"onUpdate:value":l[0]||(l[0]=e=>M.value=e),style:{width:"25%"},"default-value":M.value,options:j.value,size:"large",placeholder:"数据源","show-checkmark":!1},null,8,["value","default-value","options"]),v(i(B),{value:C.value,"onUpdate:value":l[2]||(l[2]=e=>C.value=e),style:{width:"75%"},size:"large",type:"text",placeholder:"影视名称关键字",clearable:"",loading:T.value,onKeyup:l[3]||(l[3]=k((e=>xe()),["enter"])),onFocus:V,onBlur:W},{suffix:d((()=>[v(i(J),{disabled:T.value,secondary:"",onClick:l[1]||(l[1]=e=>xe())},{icon:d((()=>[v(i(O),{icon:i(P).nav.search,class:"search-icon"},null,8,["icon"])])),_:1},8,["disabled"])])),_:1},8,["value","loading"])])),_:1})]),p(c("div",{class:"search-suggestions",onMouseenter:G,onMouseleave:X},[K.value.length>0?(w(),t("div",te,[c("div",ie,[ne,c("span",{class:"clear-history",onClick:f(Ce,["stop"])},"清空",8,ue)]),c("div",ce,[c("div",re,[(w(!0),t(h,null,y(K.value,((e,a)=>{var l;return w(),t("div",{key:`history-${a}`,class:"history-item",onClick:a=>async function(e){M.value=e.source,await xe(e.keyword)}(e)},[c("span",de,[c("span",pe,"["+b(null==(l=j.value.find((a=>a.value===e.source)))?void 0:l.label)+"]",1),S(" "+b(e.keyword),1)]),c("span",{class:"delete-icon",onClick:f((e=>function(e){F.value=!0,K.value.splice(e,1),localStorage.setItem("movieSearchHistory",JSON.stringify(K.value)),setTimeout((()=>{F.value=!1}),300)}(a)),["stop","prevent"])},"×",8,me)],8,ve)})),128))])])])):u("",!0),c("div",fe,[he,c("div",ye,[(w(!0),t(h,null,y(D.value,((e,a)=>(w(),t("div",{key:`hot-${a}`,class:"suggestion-item",onClick:a=>xe(e.text)},[c("span",{class:r(["hot-rank",{"top-3":a<3}])},b(a+1),3),c("span",_e,b(e.text),1),e.tag?(w(),t("span",{key:0,class:r(["hot-tag",ze(e.tag)])},b(e.tag),3)):u("",!0)],8,ge)))),128))])])],544),[[m,L.value]])])]),c("div",we,[(w(!0),t(h,null,y(i(z),(e=>(w(),t("div",{key:e.vod_id,class:"movie-card",onClick:a=>i(g).push(`/movie/movie-detail/${M.value}/${e.vod_id}`)},[c("div",{class:r(["movie-image",{"movie-image-horizontal":i(R)}])},[v(i(A),{lazy:"",src:e.vod_pic,alt:e.vod_name,"preview-disabled":"","object-fit":"cover","intersection-observer-options":{root:"#scrollRef",rootMargin:"200px 0px",threshold:.1}},null,8,["src","alt","intersection-observer-options"])],2),c("div",be,[c("h3",null,b(e.vod_name),1),c("span",Se,b(e.type_name),1)])],8,ke)))),128))])])],2)])])]))}}),[["__scopeId","data-v-e876726e"]]),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"})),ze="https://cdn.lookimage.live/assets/img/video_ads-989f688b.png",Me=e=>(g("data-v-a4a08fd5"),e=e(),_(),e),Te={class:"flex flex-col w-full h-full"},je={class:"flex-1 overflow-hidden"},Re={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},He={class:"movie-detail-container"},Oe={key:0,class:"player-wrapper"},Ie={key:1,class:"info-section"},Ke={class:"movie-header"},Ne={class:"movie-cover-wrapper"},Pe={class:"movie-info"},qe={class:"info-item"},De=Me((()=>c("span",{class:"label"},"类型：",-1))),Le={class:"info-item"},$e=Me((()=>c("span",{class:"label"},"导演：",-1))),Be={class:"info-item"},Je=Me((()=>c("span",{class:"label"},"主演：",-1))),Ue={class:"info-items"},Ae={class:"info-item"},Ee=Me((()=>c("span",{class:"label"},"地区：",-1))),Fe={class:"info-item"},Ve=Me((()=>c("span",{class:"label"},"语言：",-1))),We={class:"info-item"},Ge=Me((()=>c("span",{class:"label"},"状态：",-1))),Qe={class:"info-item"},Xe=Me((()=>c("span",{class:"label"},"简介：",-1))),Ye=["innerHTML"],Ze={class:"info-item"},ea=Me((()=>c("span",{class:"label"},"地区：",-1))),aa={class:"info-item"},la=Me((()=>c("span",{class:"label"},"语言：",-1))),sa={class:"info-item"},oa=Me((()=>c("span",{class:"label"},"状态：",-1))),ta={class:"info-item"},ia=Me((()=>c("span",{class:"label"},"简介：",-1))),na=["innerHTML"],ua={key:2,class:"expand-more"},ca={key:2,class:"episodes-section"},ra={class:"pagination-wrapper"},va=D(a({__name:"MovieDetail",setup(e){const a=K().token,{isMobile:p}=H(),m=M(),f=l(!1),g=l(!0),_=l(null),k=l(""),x=l(0),O=l(!1),I=l({page:1,pageSize:20,itemCount:0}),P=s((()=>{var e;if(!(null==(e=_.value)?void 0:e.vod_play_urls))return[];const a=(I.value.page-1)*I.value.pageSize,l=a+I.value.pageSize;return _.value.vod_play_urls.slice(a,l)}));function D(e){I.value.page=e,window.scrollTo({top:0,behavior:"smooth"})}const $=l(null);function B(e,a,l){if(R.isSupported()){l.hls&&l.hls.destroy();const s=new R;s.loadSource(a),s.attachMedia(e),l.hls=s,l.on("destroy",(()=>s.destroy()))}else e.canPlayType("application/vnd.apple.mpegurl")?e.src=a:l.notice.show="不支持的播放格式：m3u8"}function U(e){$.value&&($.value.destroy(),$.value=null),z((()=>{const l=document.querySelector(".player-wrapper");if(!l)return;const s=new T({container:l,url:e,type:"m3u8",customType:{m3u8:B},volume:.5,isLive:!1,muted:!1,autoplay:!0,hotkey:!0,pip:!0,autoSize:!0,autoMini:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,theme:"#23ade5",lang:"zh-cn",moreVideoAttr:{crossOrigin:"anonymous",preload:"auto"},icons:{loading:"加载中，知道你很急，但是你先别急..."},plugins:[j({html:`<img src="${ze}" style="max-width: 55%; height: auto;">`,url:"https://www.profitablecpmrate.com/esayrydd5?key=76d97011d161ef42efe0d75ec211c794",playDuration:5,totalDuration:10,i18n:{close:"关闭广告",countdown:"%s秒",detail:"查看详情",canBeClosed:"%s秒后可关闭广告"}})]});$.value=s;let o=!1;s.on("video:timeupdate",(()=>{!o&&s.currentTime>=300&&void 0===a&&Number(m.params.source)>=6&&(o=!0,s.pause(),f.value=!0,s.on("video:play",(()=>{s.pause(),f.value=!0})))})),s.on("error",(()=>{s.notice.show="视频加载失败，请稍后重试"})),s.on("ready",(()=>{}))}))}function Q(){f.value=!1}return C((()=>{!async function(){try{const e=await N(Number(m.params.source),m.params.id);0===e.code&&e.data.length>0&&(_.value=e.data[0],I.value.itemCount=_.value.vod_play_urls.length,_.value.vod_play_urls.length>0&&(k.value=_.value.vod_play_urls[0].play_url,x.value=0,z((()=>{U(k.value)}))))}catch(e){}finally{g.value=!1}}()})),o((()=>{$.value&&($.value.destroy(),$.value=null)})),(e,a)=>{var l;return w(),t("div",Te,[i(p)?(w(),n(q,{key:0})):u("",!0),c("main",je,[c("div",Re,[c("div",He,[k.value?(w(),t("div",Oe)):u("",!0),_.value?(w(),t("div",Ie,[v(i(F),null,{default:d((()=>[c("div",Ke,[c("div",Ne,[v(i(A),{src:_.value.vod_pic,alt:_.value.vod_name,class:"movie-cover","preview-disabled":"","object-fit":"cover"},null,8,["src","alt"])]),c("div",Pe,[c("h1",null,b(_.value.vod_name),1),v(i(E),{vertical:"",size:"small"},{default:d((()=>[c("div",qe,[De,c("span",null,b(_.value.type_name),1)]),c("div",Le,[$e,c("span",null,b(_.value.vod_director),1)]),c("div",Be,[Je,c("span",null,b(_.value.vod_actor),1)]),i(p)?(w(),t("div",{key:0,class:r(["expandable-content",{collapsed:!O.value}])},[c("div",Ue,[c("div",Ae,[Ee,c("span",null,b(_.value.vod_area),1)]),c("div",Fe,[Ve,c("span",null,b(_.value.vod_lang),1)]),c("div",We,[Ge,c("span",null,b(_.value.vod_remarks),1)]),c("div",Qe,[Xe,c("div",{class:"movie-desc",innerHTML:_.value.vod_content},null,8,Ye)])])],2)):(w(),t(h,{key:1},[c("div",Ze,[ea,c("span",null,b(_.value.vod_area),1)]),c("div",aa,[la,c("span",null,b(_.value.vod_lang),1)]),c("div",sa,[oa,c("span",null,b(_.value.vod_remarks),1)]),c("div",ta,[ia,c("div",{class:"movie-desc",innerHTML:_.value.vod_content},null,8,na)])],64)),i(p)?(w(),t("div",ua,[v(i(J),{text:"",onClick:a[0]||(a[0]=e=>O.value=!O.value)},{default:d((()=>[S(b(O.value?"收起":"展开更多"),1)])),_:1})])):u("",!0)])),_:1})])])])),_:1})])):u("",!0),(null==(l=_.value)?void 0:l.vod_play_urls.length)?(w(),t("div",ca,[v(i(F),{title:"剧集列表"},{default:d((()=>[v(i(V),{cols:i(p)?4:8,"x-gap":8,"y-gap":8},{default:d((()=>[(w(!0),t(h,null,y(i(P),((e,a)=>(w(),n(i(W),{key:e.play_id},{default:d((()=>[v(i(J),{block:"",type:x.value===(I.value.page-1)*I.value.pageSize+a?"primary":"default",onClick:l=>function(e,a){k.value=e,x.value=a,U(e)}(e.play_url,(I.value.page-1)*I.value.pageSize+a)},{default:d((()=>[S(b(e.play_num),1)])),_:2},1032,["type","onClick"])])),_:2},1024)))),128))])),_:1},8,["cols"]),c("div",ra,[v(i(G),{page:I.value.page,"onUpdate:page":[a[1]||(a[1]=e=>I.value.page=e),D],size:i(p)?"small":"medium","item-count":I.value.itemCount,"page-size":I.value.pageSize,"show-quick-jumper":""},null,8,["page","size","item-count","page-size"])])])),_:1})])):u("",!0)])]),v(L,{visible:f.value,onCancel:Q},null,8,["visible"])])])}}}),[["__scopeId","data-v-a4a08fd5"]]),da=Object.freeze(Object.defineProperty({__proto__:null,default:va},Symbol.toStringTag,{value:"Module"}));export{Ce as M,da as a,ze as v};
