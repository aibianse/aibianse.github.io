import{d as e,v as a,e as l,E as s,G as i,n as u,u as o,c as n,q as t,p as r,a as v,w as c,C as d,A as p,W as m,o as f,t as y,H as _,x as h,F as g,J as b,Y as k,M as w,N as x}from"./vue-vendor-61cc29ec.js";import{c as C,e as M,D as S}from"./common-429a40e1.js";import{c as T,b as z,a as H}from"./image-modules-34a440f9.js";import{E as j,i as L,p as W,q as R,v as q,x as A}from"./naive-ui-b24daaf4.js";import"./utils-f1e0c1c0.js";import"./layout-ba237d8b.js";const N=e=>(w("data-v-141375f8"),e=e(),x(),e),P={class:"flex flex-col w-full h-full"},D={class:"flex-1 overflow-hidden"},E={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},G={class:"movie-detail-container"},I={key:0,class:"player-wrapper"},K={key:1,class:"info-section"},O={class:"movie-header"},B={class:"movie-info"},F={class:"info-item"},J=N((()=>r("span",{class:"label"},"品番：",-1))),U={class:"value"},V={class:"info-item"},Y=N((()=>r("span",{class:"label"},"出演者：",-1))),$={class:"value"},Q={class:"info-item"},X=N((()=>r("span",{class:"label"},"导演：",-1))),Z={class:"value"},ee={class:"info-item"},ae=N((()=>r("span",{class:"label"},"发布日期：",-1))),le={class:"value"},se={class:"info-item"},ie=N((()=>r("span",{class:"label"},"制造商：",-1))),ue={class:"value"},oe={class:"info-item"},ne=N((()=>r("span",{class:"label"},"时长：",-1))),te={class:"value"},re=N((()=>r("br",null,null,-1))),ve={class:"info-items"},ce={class:"info-item"},de=["innerHTML"],pe={key:1,class:"info-item"},me=["innerHTML"],fe={key:2,class:"expand-more"},ye={key:2,class:"episodes-section"},_e={key:3,class:"episodes-section"},he=H(e({__name:"RebdDetail",setup(e){const w=C().token,{isMobile:x}=M(),H=p(),N=a(!1),he=a(!0),ge=a(null),be=a(""),ke=a(0),we=a(!1),xe=a({page:1,pageSize:20,itemCount:0}),Ce=l((()=>{var e;if(!(null==(e=ge.value)?void 0:e.vod_play_urls))return[];const a=(xe.value.page-1)*xe.value.pageSize,l=a+xe.value.pageSize;return ge.value.vod_play_urls.slice(a,l)})),Me=a(null);function Se(e,a,l){if(k.isSupported()){l.hls&&l.hls.destroy();const s=new k({xhrSetup:e=>{e.withCredentials=!0;const a=document.cookie.split(";").find((e=>e.trim().startsWith("session=")));if(a){const l=a.trim().split("=")[1];e.setRequestHeader("Cookie",`session=${l}`)}}});s.loadSource(a),s.attachMedia(e),l.hls=s,l.on("destroy",(()=>s.destroy()))}else e.canPlayType("application/vnd.apple.mpegurl")?e.src=a:l.notice.show="不支持的播放格式：m3u8"}function Te(e){Me.value&&(Me.value.destroy(),Me.value=null),d((()=>{var a;const l=document.querySelector(".player-wrapper");if(!l)return;const s=new m({withCredentials:!0,container:l,url:e,type:"m3u8",customType:{m3u8:Se},poster:null==(a=ge.value)?void 0:a.cover_image_url,volume:.5,isLive:!1,muted:!1,autoplay:!1,hotkey:!0,pip:!0,autoSize:!0,autoMini:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,theme:"#23ade5",lang:"zh-cn",moreVideoAttr:{crossOrigin:"use-credentials",preload:"auto"},icons:{loading:"加载中，知道你很急，但是你先别急..."},headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36"},plugins:[]});Me.value=s;let i=!1;s.on("video:timeupdate",(()=>{!i&&s.currentTime>=300&&void 0===w&&Number(H.params.source)>=6&&(i=!0,s.pause(),N.value=!0,s.on("video:play",(()=>{s.pause(),N.value=!0})))})),s.on("error",(()=>{s.notice.show="视频加载失败，请稍后重试"})),s.on("ready",(()=>{}))}))}function ze(){N.value=!1}return s((()=>{!async function(){try{const e=await S(H.params.code);0===e.code&&e.data.length>0&&(ge.value=e.data[0],ge.value.preview_image_url.unshift(ge.value.cover_image_url),xe.value.itemCount=ge.value.vod_play_urls.length,ge.value.vod_play_urls.length>0&&(be.value=ge.value.vod_play_urls[0].play_url,ke.value=0,d((()=>{Te(be.value)}))))}catch(e){}finally{he.value=!1}}()})),i((()=>{Me.value&&(Me.value.destroy(),Me.value=null)})),(e,a)=>{var l,s;return f(),u("div",P,[o(x)?(f(),n(z,{key:0})):t("",!0),r("main",D,[r("div",E,[r("div",G,[be.value?(f(),u("div",I)):t("",!0),ge.value?(f(),u("div",K,[v(o(W),null,{default:c((()=>[r("div",O,[r("div",B,[r("h1",null,y(ge.value.name),1),v(o(j),{vertical:"",size:"small"},{default:c((()=>[r("div",F,[J,r("span",U,y(ge.value.code),1)]),r("div",V,[Y,r("span",$,y(ge.value.actor),1)]),r("div",Q,[X,r("span",Z,y(ge.value.director),1)]),r("div",ee,[ae,r("span",le,y(ge.value.publish_time),1)]),r("div",se,[ie,r("span",ue,y(ge.value.manufacturer),1)]),r("div",oe,[ne,r("span",te,y(ge.value.video_length)+"分钟",1)]),re,o(x)?(f(),u("div",{key:0,class:_(["expandable-content",{collapsed:!we.value}])},[r("div",ve,[r("div",ce,[r("div",{class:"value movie-desc",innerHTML:ge.value.description},null,8,de)])])],2)):(f(),u("div",pe,[r("div",{class:"value movie-desc",innerHTML:ge.value.description},null,8,me)])),o(x)?(f(),u("div",fe,[v(o(L),{text:"",onClick:a[0]||(a[0]=e=>we.value=!we.value)},{default:c((()=>[h(y(we.value?"收起":"展开描述"),1)])),_:1})])):t("",!0)])),_:1})])])])),_:1})])):t("",!0),(null==(l=ge.value)?void 0:l.preview_image_url.length)?(f(),u("div",ye,[v(o(W),{title:"预览图片"},{default:c((()=>[(f(!0),u(g,null,b(ge.value.preview_image_url,((e,a)=>(f(),n(o(R),{key:a,class:"preview-img",src:e},null,8,["src"])))),128))])),_:1})])):t("",!0),(null==(s=ge.value)?void 0:s.vod_play_urls.length)?(f(),u("div",_e,[v(o(W),{title:"播放列表"},{default:c((()=>[v(o(q),{cols:o(x)?4:8,"x-gap":8,"y-gap":8},{default:c((()=>[(f(!0),u(g,null,b(o(Ce),((e,a)=>(f(),n(o(A),{key:a},{default:c((()=>[v(o(L),{block:"",disabled:null===e.play_url,onClick:a=>{return l=e.play_url,be.value=l,void Te(l);var l}},{default:c((()=>[h(y(0===a?"预览":null!==e.play_url&&void 0!==e.play_url?"正片":"暂无"),1)])),_:2},1032,["disabled","onClick"])])),_:2},1024)))),128))])),_:1},8,["cols"])])),_:1})])):t("",!0)])]),v(T,{visible:N.value,onCancel:ze},null,8,["visible"])])])}}}),[["__scopeId","data-v-141375f8"]]);export{he as default};
