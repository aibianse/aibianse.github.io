import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-a77144da.js";import{d as ae,l as te,m as n,u as se,q as oe,s as le,o as ne,v as ie,w as re,c as p,a,b as _,e as x,f as i,n as L,j as l,x as o,F as U,r as M,y as ce,T as ue,i as r,z,A as d,N as j,B as P,C as de,_ as pe,I as he,D as w,E as ve,G as ge,H as fe,k as me}from"./index-11cd024d.js";import{_ as _e}from"./R18Permission.vue_vue_type_script_setup_true_lang-0f588a6f.js";import{N as xe,a as we}from"./Grid-02da0490.js";import{N as S}from"./Spin-4245650a.js";import"./index-3d7a1754.js";const ye={class:"flex flex-col w-full h-full"},ke={class:"flex-1 overflow-hidden"},be={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},Ce={class:"image_wrap"},Ne={key:2,class:"group_image_text"},$e={class:"w-full max-w-screen-xl m-auto"},Ie={class:"flex items-center justify-between space-x-2"},Ue={class:"flex justify-between items-center w-full"},Me={class:"space-x-2"},ze={class:"space-x-2"},je=ae({__name:"ImageTag",setup(Se){const q=te(),C=n(!1),F=q.token,{isMobile:h}=se(),v=oe(),T=new AbortController,N=n(!1),$=n([]),y=n(1),B=n(0),E=n(!0),m=n(!1),k=n(!1),I=n([]),V=n(""),g=n([]),f=n([]),A=s=>s.replace("aibianse.pages.dev","cdn.aibianse.com"),D=async(s,t)=>{if(s.length===0){v.error("标签参数为空");return}try{N.value=!0,$.value=[];const e=await ce(s,t,{signal:T.signal});$.value=e.data.rows.map(c=>({...c,url:A(c.url)})),B.value=Math.ceil(e.data.total/20),E.value=!0}catch(e){v.error("获取图片失败，请重试"),console.error(e)}finally{N.value=!1}},G=async()=>{f.value=[];try{const t=(await ue()).data.rows;for(const e in t)f.value.push(t[e].name)}catch{v.error("查询标签失败，请刷新页面重试！")}},b=le((s,t)=>{D(s,t)},300);ne(async()=>{await G(),g.value=f.value,await D(g.value,1)});function R(){m.value=!0,f.value.length===0&&G()}const u=n([]);function H(s){u.value=[],u.value=s}function O(){u.value.length>0&&(u.value=g.value),m.value=!1}function W(){u.value.length===0?v.error("查询的标签为空！"):(b(u.value,1),v.success("查询中，知道你很急，但你先别急..."),g.value=u.value,m.value=!1)}async function J(s){var t;try{I.value=[],k.value=!0;const e=await fe(s);I.value=e.data.rows.map(c=>({...c,url:A(c.url)})),V.value=((t=e.data.rows[0])==null?void 0:t.name)||"详情"}catch{v.error("获取组图失败，请重试"),k.value=!1}}const K=ie(()=>{let s=["p-4"];return h.value&&(s=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),s});re(()=>{N.value&&T.abort(),b.cancel()});function Q(s){u.value=s?[...f.value]:[]}function X(){u.value=[]}function Y(){C.value=!0}function Z(){C.value=!1}return(s,t)=>(r(),p("div",ye,[a(h)?(r(),_(ee,{key:0})):x("",!0),i("main",ke,[i("div",be,[i("div",{id:"image-wrapper image-scroll-container",class:L(["w-full max-w-screen-xl m-auto dark:bg-[#101014]",[a(h)?"p-2":"p-4"]])},[i("div",Ce,[l(a(P),{show:k.value,"onUpdate:show":t[0]||(t[0]=e=>k.value=e),class:"custom-card",preset:"card",style:{width:"95%",maxWidth:"650px"},title:V.value,size:"huge",bordered:!1,segmented:{content:"soft",footer:"soft"}},{default:o(()=>[(r(!0),p(U,null,M(I.value,(e,c)=>(r(),_(a(j),{key:c,lazy:"",src:e.url},{placeholder:o(()=>[i("div",{style:z({width:`${e.width}px`,height:e.height<1e3?`${e.height*.3}px`:e.height>=1e3&&e.height<=2e3?`${e.height*.2}px`:`${e.height*.1}px`,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[l(a(S),null,{default:o(()=>[d(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src"]))),128))]),_:1},8,["show","title"]),(r(!0),p(U,null,M($.value,(e,c)=>(r(),p("div",{key:c,class:"image_item"},[e.type===10?(r(),_(a(j),{key:0,lazy:"",src:e.url,"intersection-observer-options":{root:null,rootMargin:"0px 0px 200px 0px",threshold:.5}},{placeholder:o(()=>[i("div",{style:z({width:`${e.width}px`,height:e.height<1e3?`${e.height*.3}px`:e.height>=1e3&&e.height<=2e3?`${e.height*.2}px`:`${e.height*.1}px`,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[l(a(S),null,{default:o(()=>[d(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src","intersection-observer-options"])):x("",!0),e.x_rated===20&&a(F)===void 0?(r(),p("div",{key:1,class:"unlock-button",onClick:Y}," 点击解锁查看 ")):x("",!0),e.type===20?(r(),p("div",Ne," 组图 ")):x("",!0),e.type!==10?(r(),_(a(j),{key:3,lazy:"",src:e.url,"preview-disabled":"","intersection-observer-options":{root:null,rootMargin:"0px 0px 200px 0px",threshold:.5},onClick:Te=>J(e.group_id??"")},{placeholder:o(()=>[i("div",{style:z({width:`${e.width}px`,height:e.height<1e3?`${e.height*.3}px`:e.height>=1e3&&e.height<=2e3?`${e.height*.2}px`:`${e.height*.1}px`,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[l(a(S),null,{default:o(()=>[d(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src","intersection-observer-options","onClick"])):x("",!0)]))),128))])],2)]),l(_e,{visible:C.value,onCancel:Z},null,8,["visible"])]),i("footer",{class:L(a(K))},[i("div",$e,[i("div",Ie,[l(a(de),{page:y.value,"onUpdate:page":[t[1]||(t[1]=e=>y.value=e),t[2]||(t[2]=e=>a(b)(g.value,y.value))],"page-count":B.value,size:"large",simple:a(h),"page-slot":a(h)?void 0:5,"show-quick-jumper":!a(h),"onUpdate:pageSize":t[3]||(t[3]=e=>a(b)(g.value,y.value))},null,8,["page","page-count","simple","page-slot","show-quick-jumper"]),l(a(w),{onClick:R},{default:o(()=>[l(a(pe),{icon:a(he).nav.search},null,8,["icon"]),d(" 标签筛选 ")]),_:1}),l(a(P),{show:m.value,"onUpdate:show":t[5]||(t[5]=e=>m.value=e),preset:"dialog",title:"选择标签","footer-style":{padding:"12px 24px"},style:{width:"90%","max-width":"600px"}},{action:o(()=>[i("div",Ue,[i("div",Me,[l(a(w),{onClick:t[4]||(t[4]=e=>Q(!0))},{default:o(()=>[d(" 全选 ")]),_:1}),l(a(w),{onClick:X},{default:o(()=>[d(" 清空 ")]),_:1})]),i("div",ze,[l(a(w),{onClick:O},{default:o(()=>[d(" 取消 ")]),_:1}),l(a(w),{type:"primary",onClick:W},{default:o(()=>[d(" 筛选 ")]),_:1})])])]),default:o(()=>[l(a(ve),{value:u.value,"onUpdate:value":H},{default:o(()=>[l(a(xe),{"y-gap":8,cols:2},{default:o(()=>[(r(!0),p(U,null,M(f.value,(e,c)=>(r(),_(a(we),{key:c},{default:o(()=>[l(a(ge),{value:e,label:e},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])])])],2)]))}});const Pe=me(je,[["__scopeId","data-v-d5726dc3"]]);export{Pe as default};
