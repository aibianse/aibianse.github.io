import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-dd90b380.js";import{v as ie,k as ve,l as j,m as g,q as he,s as me,d as ee,w as ge,x as V,y as O,z as ye,A as we,B as Q,C as re,D as _e,E as te,G as xe,H as se,V as be,J as Se,K as Ce,L as ae,M as Re,u as $e,N as Ne,O as ke,P as Ge,c as T,a as u,b as z,e as X,f as S,n as oe,h as _,Q as m,F as W,r as Y,R as Ie,T as Me,o as N,S as H,U as E,W as ne,X as Be,_ as Ee,I as je,Y as L,Z as De,$ as Te,a0 as Ae,j as Ve}from"./index-ef195141.js";import{N as J}from"./Image-57c4a521.js";import{N as Z}from"./Spin-d1d9a29c.js";function Ue(t){if(typeof t=="number")return{"":t.toString()};const s={};return t.split(/ +/).forEach(o=>{if(o==="")return;const[n,a]=o.split(":");a===void 0?s[""]=n:s[n]=a}),s}function A(t,s){var o;if(t==null)return;const n=Ue(t);if(s===void 0)return n[""];if(typeof s=="string")return(o=n[s])!==null&&o!==void 0?o:n[""];if(Array.isArray(s)){for(let a=s.length-1;a>=0;--a){const l=s[a];if(l in n)return n[l]}return n[""]}else{let a,l=-1;return Object.keys(n).forEach(r=>{const d=Number(r);!Number.isNaN(d)&&s>=d&&d>=l&&(l=d,a=n[r])}),a}}function ze(t){var s;const o=(s=t.dirs)===null||s===void 0?void 0:s.find(({dir:n})=>n===ie);return!!(o&&o.value===!1)}const Le={xs:0,s:640,m:1024,l:1280,xl:1536,"2xl":1920};function Pe(t){return`(min-width: ${t}px)`}const P={};function Oe(t=Le){if(!ve)return j(()=>[]);if(typeof window.matchMedia!="function")return j(()=>[]);const s=g({}),o=Object.keys(t),n=(a,l)=>{a.matches?s.value[l]=!0:s.value[l]=!1};return o.forEach(a=>{const l=t[a];let r,d;P[l]===void 0?(r=window.matchMedia(Pe(l)),r.addEventListener?r.addEventListener("change",y=>{d.forEach(f=>{f(y,a)})}):r.addListener&&r.addListener(y=>{d.forEach(f=>{f(y,a)})}),d=new Set,P[l]={mql:r,cbs:d}):(r=P[l].mql,d=P[l].cbs),d.add(n),r.matches&&d.forEach(y=>{y(r,a)})}),he(()=>{o.forEach(a=>{const{cbs:l}=P[t[a]];l.has(n)&&l.delete(n)})}),j(()=>{const{value:a}=s;return o.filter(l=>a[l])})}const le=1,ue=me("n-grid"),de=1,qe={span:{type:[Number,String],default:de},offset:{type:[Number,String],default:0},suffix:Boolean,privateOffset:Number,privateSpan:Number,privateColStart:Number,privateShow:{type:Boolean,default:!0}},Fe=ee({__GRID_ITEM__:!0,name:"GridItem",alias:["Gi"],props:qe,setup(){const{isSsrRef:t,xGapRef:s,itemStyleRef:o,overflowRef:n,layoutShiftDisabledRef:a}=ye(ue),l=ge();return{overflow:n,itemStyle:o,layoutShiftDisabled:a,mergedXGap:j(()=>V(s.value||0)),deriveStyle:()=>{t.value;const{privateSpan:r=de,privateShow:d=!0,privateColStart:y=void 0,privateOffset:f=0}=l.vnode.props,{value:k}=s,G=V(k||0);return{display:d?"":"none",gridColumn:`${y??`span ${r}`} / span ${r}`,marginLeft:f?`calc((100% - (${r} - 1) * ${G}) / ${r} * ${f} + ${G} * ${f})`:""}}}},render(){var t,s;if(this.layoutShiftDisabled){const{span:o,offset:n,mergedXGap:a}=this;return O("div",{style:{gridColumn:`span ${o} / span ${o}`,marginLeft:n?`calc((100% - (${o} - 1) * ${a}) / ${o} * ${n} + ${a} * ${n})`:""}},this.$slots)}return O("div",{style:[this.itemStyle,this.deriveStyle()]},(s=(t=this.$slots).default)===null||s===void 0?void 0:s.call(t,{overflow:this.overflow}))}}),Qe={xs:0,s:640,m:1024,l:1280,xl:1536,xxl:1920},fe=24,K="__ssr__",Xe={layoutShiftDisabled:Boolean,responsive:{type:[String,Boolean],default:"self"},cols:{type:[Number,String],default:fe},itemResponsive:Boolean,collapsed:Boolean,collapsedRows:{type:Number,default:1},itemStyle:[Object,String],xGap:{type:[Number,String],default:0},yGap:{type:[Number,String],default:0}},We=ee({name:"Grid",inheritAttrs:!1,props:Xe,setup(t){const{mergedClsPrefixRef:s,mergedBreakpointsRef:o}=we(t),n=/^\d+$/,a=g(void 0),l=Oe((o==null?void 0:o.value)||Qe),r=Q(()=>!!(t.itemResponsive||!n.test(t.cols.toString())||!n.test(t.xGap.toString())||!n.test(t.yGap.toString()))),d=j(()=>{if(r.value)return t.responsive==="self"?a.value:l.value}),y=Q(()=>{var p;return(p=Number(A(t.cols.toString(),d.value)))!==null&&p!==void 0?p:fe}),f=Q(()=>A(t.xGap.toString(),d.value)),k=Q(()=>A(t.yGap.toString(),d.value)),G=p=>{a.value=p.contentRect.width},C=p=>{Re(G,p)},x=g(!1),b=j(()=>{if(t.responsive==="self")return C}),w=g(!1),I=g();return re(()=>{const{value:p}=I;p&&p.hasAttribute(K)&&(p.removeAttribute(K),w.value=!0)}),_e(ue,{layoutShiftDisabledRef:te(t,"layoutShiftDisabled"),isSsrRef:w,itemStyleRef:te(t,"itemStyle"),xGapRef:f,overflowRef:x}),{isSsr:!xe,contentEl:I,mergedClsPrefix:s,style:j(()=>t.layoutShiftDisabled?{width:"100%",display:"grid",gridTemplateColumns:`repeat(${t.cols}, minmax(0, 1fr))`,columnGap:V(t.xGap),rowGap:V(t.yGap)}:{width:"100%",display:"grid",gridTemplateColumns:`repeat(${y.value}, minmax(0, 1fr))`,columnGap:V(f.value),rowGap:V(k.value)}),isResponsive:r,responsiveQuery:d,responsiveCols:y,handleResize:b,overflow:x}},render(){if(this.layoutShiftDisabled)return O("div",se({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style},this.$attrs),this.$slots);const t=()=>{var s,o,n,a,l,r,d;this.overflow=!1;const y=Se(Ce(this)),f=[],{collapsed:k,collapsedRows:G,responsiveCols:C,responsiveQuery:x}=this;y.forEach(i=>{var D,v,R,M,U;if(((D=i==null?void 0:i.type)===null||D===void 0?void 0:D.__GRID_ITEM__)!==!0)return;if(ze(i)){const B=ae(i);B.props?B.props.privateShow=!1:B.props={privateShow:!1},f.push({child:B,rawChildSpan:0});return}i.dirs=((v=i.dirs)===null||v===void 0?void 0:v.filter(({dir:B})=>B!==ie))||null,((R=i.dirs)===null||R===void 0?void 0:R.length)===0&&(i.dirs=null);const q=ae(i),F=Number((U=A((M=q.props)===null||M===void 0?void 0:M.span,x))!==null&&U!==void 0?U:le);F!==0&&f.push({child:q,rawChildSpan:F})});let b=0;const w=(s=f[f.length-1])===null||s===void 0?void 0:s.child;if(w!=null&&w.props){const i=(o=w.props)===null||o===void 0?void 0:o.suffix;i!==void 0&&i!==!1&&(b=Number((a=A((n=w.props)===null||n===void 0?void 0:n.span,x))!==null&&a!==void 0?a:le),w.props.privateSpan=b,w.props.privateColStart=C+1-b,w.props.privateShow=(l=w.props.privateShow)!==null&&l!==void 0?l:!0)}let I=0,p=!1;for(const{child:i,rawChildSpan:D}of f){if(p&&(this.overflow=!0),!p){const v=Number((d=A((r=i.props)===null||r===void 0?void 0:r.offset,x))!==null&&d!==void 0?d:0),R=Math.min(D+v,C);if(i.props?(i.props.privateSpan=R,i.props.privateOffset=v):i.props={privateSpan:R,privateOffset:v},k){const M=I%C;R+M>C&&(I+=C-M),R+I+b>G*C?p=!0:I+=R}}p&&(i.props?i.props.privateShow!==!0&&(i.props.privateShow=!1):i.props={privateShow:!1})}return O("div",se({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style,[K]:this.isSsr||void 0},this.$attrs),f.map(({child:i})=>i))};return this.isResponsive&&this.responsive==="self"?O(be,{onResize:this.handleResize},{default:t}):t()}}),Ye={class:"flex flex-col w-full h-full"},He={class:"flex-1 overflow-hidden"},Je={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},Ze={class:"image_wrap"},Ke={key:1,class:"group_image_text"},et={class:"w-full max-w-screen-xl m-auto"},tt={class:"flex items-center justify-between space-x-2"},st={class:"flex justify-between items-center w-full"},at={class:"space-x-2"},ot={class:"space-x-2"},nt=ee({__name:"ImageTag",setup(t){const{isMobile:s}=$e(),o=Ne(),n=new AbortController,a=g(!1),l=g([]),r=g(1),d=g(0),y=g(!0),f=g(!1),k=g(!1),G=g([]),C=g(""),x=g([]),b=g([]),w=h=>h.replace("aibianse.pages.dev","cdn.aibianse.com"),I=async(h,c)=>{if(h.length===0){o.error("标签参数为空");return}try{a.value=!0,l.value=[];const e=await Ie(h,c,{signal:n.signal});l.value=e.data.rows.map($=>({...$,url:w($.url)})),d.value=Math.ceil(e.data.total/20),y.value=!0}catch(e){if(e.name==="AbortError"){console.log("Request was cancelled");return}o.error("获取图片失败，请重试"),console.error(e)}finally{a.value=!1}},p=async()=>{b.value=[];try{const c=(await Me()).data.rows;for(const e in c)b.value.push(c[e].name)}catch{o.error("查询标签失败，请刷新页面重试！")}},i=ke((h,c)=>{I(h,c)},300);re(async()=>{await p(),x.value=b.value,await I(x.value,1)});function D(){f.value=!0,b.value.length===0&&p()}const v=g([]);function R(h){v.value=[],v.value=h}function M(){v.value.length>0&&(v.value=x.value),f.value=!1}function U(){v.value.length===0?o.error("查询的标签为空！"):(i(v.value,1),o.success("查询中，知道你很急，但你先别急..."),x.value=v.value,f.value=!1)}async function q(h){var c;try{G.value=[],k.value=!0;const e=await Ae(h);G.value=e.data.rows.map($=>({...$,url:w($.url)})),C.value=((c=e.data.rows[0])==null?void 0:c.name)||"详情"}catch{o.error("获取组图失败，请重试"),k.value=!1}}const F=j(()=>{let h=["p-4"];return s.value&&(h=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),h});Ge(()=>{a.value&&n.abort(),i.cancel()});function B(h){v.value=h?[...b.value]:[]}function ce(){v.value=[]}return(h,c)=>(N(),T("div",Ye,[u(s)?(N(),z(pe,{key:0})):X("",!0),S("main",He,[S("div",Je,[S("div",{id:"image-wrapper image-scroll-container",class:oe(["w-full max-w-screen-xl m-auto dark:bg-[#101014]",[u(s)?"p-2":"p-4"]])},[S("div",Ze,[_(u(ne),{show:k.value,"onUpdate:show":c[0]||(c[0]=e=>k.value=e),class:"custom-card",preset:"card",style:{width:"95%",maxWidth:"650px"},title:C.value,size:"huge",bordered:!1,segmented:{content:"soft",footer:"soft"}},{default:m(()=>[(N(!0),T(W,null,Y(G.value,(e,$)=>(N(),z(u(J),{key:$,lazy:"",src:e.url},{placeholder:m(()=>[S("div",{style:H({width:`${e.width}px`,height:e.height<1e3?`${e.height*.3}px`:e.height>=1e3&&e.height<=2e3?`${e.height*.2}px`:`${e.height*.1}px`,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[_(u(Z),null,{default:m(()=>[E(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src"]))),128))]),_:1},8,["show","title"]),(N(!0),T(W,null,Y(l.value,(e,$)=>(N(),T("div",{key:$,class:"image_item"},[e.type===10?(N(),z(u(J),{key:0,lazy:"",src:e.url,"intersection-observer-options":{root:null,rootMargin:"0px 0px 200px 0px",threshold:.5}},{placeholder:m(()=>[S("div",{style:H({width:`${e.width}px`,height:e.height<1e3?`${e.height*.3}px`:e.height>=1e3&&e.height<=2e3?`${e.height*.2}px`:`${e.height*.1}px`,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[_(u(Z),null,{default:m(()=>[E(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src","intersection-observer-options"])):X("",!0),e.type===20?(N(),T("div",Ke," 组图 ")):X("",!0),e.type!==10?(N(),z(u(J),{key:2,lazy:"",src:e.url,"preview-disabled":"","intersection-observer-options":{root:null,rootMargin:"0px 0px 200px 0px",threshold:.5},onClick:lt=>q(e.group_id)},{placeholder:m(()=>[S("div",{style:H({width:`${e.width}px`,height:e.height<1e3?`${e.height*.3}px`:e.height>=1e3&&e.height<=2e3?`${e.height*.2}px`:`${e.height*.1}px`,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0001"})},[_(u(Z),null,{default:m(()=>[E(" 知道你很急，但是你先别急... ")]),_:1})],4)]),_:2},1032,["src","intersection-observer-options","onClick"])):X("",!0)]))),128))])],2)])]),S("footer",{class:oe(u(F))},[S("div",et,[S("div",tt,[_(u(Be),{page:r.value,"onUpdate:page":[c[1]||(c[1]=e=>r.value=e),c[2]||(c[2]=e=>u(i)(x.value,r.value))],"page-count":d.value,size:"large",simple:u(s),"page-slot":u(s)?void 0:5,"show-quick-jumper":!u(s),"onUpdate:pageSize":c[3]||(c[3]=e=>u(i)(x.value,r.value))},null,8,["page","page-count","simple","page-slot","show-quick-jumper"]),_(u(L),{onClick:D},{default:m(()=>[_(u(Ee),{icon:u(je).nav.search},null,8,["icon"]),E(" 标签筛选 ")]),_:1}),_(u(ne),{show:f.value,"onUpdate:show":c[5]||(c[5]=e=>f.value=e),preset:"dialog",title:"选择标签","footer-style":{padding:"12px 24px"},style:{width:"90%","max-width":"600px"}},{action:m(()=>[S("div",st,[S("div",at,[_(u(L),{onClick:c[4]||(c[4]=e=>B(!0))},{default:m(()=>[E(" 全选 ")]),_:1}),_(u(L),{onClick:ce},{default:m(()=>[E(" 清空 ")]),_:1})]),S("div",ot,[_(u(L),{onClick:M},{default:m(()=>[E(" 取消 ")]),_:1}),_(u(L),{type:"primary",onClick:U},{default:m(()=>[E(" 筛选 ")]),_:1})])])]),default:m(()=>[_(u(De),{value:v.value,"onUpdate:value":R},{default:m(()=>[_(u(We),{"y-gap":8,cols:2},{default:m(()=>[(N(!0),T(W,null,Y(b.value,(e,$)=>(N(),z(u(Fe),{key:$},{default:m(()=>[_(u(Te),{value:e,label:e},null,8,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])])])],2)]))}});const ft=Ve(nt,[["__scopeId","data-v-7e9326b4"]]);export{ft as default};
