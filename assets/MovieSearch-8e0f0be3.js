import{ai as z,d as E,u as U,m as d,s as Y,v as N,c as l,a as c,b as q,e as S,f as e,n as w,j as g,w as $,aj as A,a0 as G,ak as P,al as b,F as x,r as k,p as Q,g as W,i,B as X,_ as Z,I as ee,Y as se,t as h,h as te,am as oe,k as ae}from"./index-bf05176f.js";import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-c8943c5d.js";import{N as ie}from"./Image-f6b17d90.js";const le=z("movie",{state:()=>({searchKeyword:"",searchResults:[]}),actions:{setSearchResults(r){this.searchResults=r},setSearchKeyword(r){this.searchKeyword=r}}}),B=r=>(Q("data-v-307c35c7"),r=r(),W(),r),ce={class:"flex flex-col w-full h-full"},re={class:"flex-1 overflow-hidden"},ue={id:"scrollRef",class:"h-full overflow-hidden overflow-y-auto"},de={class:"movie-search-container"},he={class:"search-container"},ve={class:"search-wrapper"},_e={class:"search-input-wrapper"},fe={key:0,class:"suggestion-section"},pe={class:"section-header"},me=B(()=>e("span",null,"搜索历史",-1)),ge=["onClick"],ye={class:"history-list"},Se={class:"history-grid"},we=["onClick"],xe={class:"history-text"},ke=["onClick"],Ce={class:"suggestion-section"},Ie=B(()=>e("div",{class:"section-header"},[e("span",null,"热搜榜")],-1)),Me={class:"hot-search-list"},Ne=["onClick"],$e={class:"hot-text"},be={class:"results-container"},Be=["onClick"],He={class:"movie-image"},Ke={class:"movie-info"},Re={class:"type-tag"},Te=E({__name:"MovieSearch",setup(r){const{isMobile:C}=U(),H=te(),v=le(),_=d(v.searchKeyword),K=Y(()=>v.searchResults),f=d(!1),o=d([]),R=d(!1),T=d([{text:"娼年",tag:"热"},{text:"回复术士的重来人生",tag:"热"}]),p=d(!1);let n=null;const y=d(!1);function F(){n&&(clearTimeout(n),n=null),p.value=!0}function I(){n=setTimeout(()=>{y.value||(p.value=!1)},200)}function O(){n&&(clearTimeout(n),n=null)}function j(){I()}N(()=>{n&&(clearTimeout(n),n=null)});function D(a){if(!a.trim())return;const t=o.value.indexOf(a);t>-1&&o.value.splice(t,1),o.value.unshift(a),o.value.length>10&&o.value.pop(),localStorage.setItem("movieSearchHistory",JSON.stringify(o.value))}o.value=JSON.parse(localStorage.getItem("movieSearchHistory")||"[]");async function m(a){a&&(_.value=a),p.value=!1;const t=a||_.value;if(t.trim()){R.value=!1,f.value=!0;try{const s=await oe(t);s.code===0&&(v.setSearchResults(s.data),v.setSearchKeyword(t),D(t))}catch(s){console.error("Search failed:",s)}finally{f.value=!1}}}function J(){o.value=[],localStorage.removeItem("movieSearchHistory")}function L(a){switch(a){case"热":return"hot";case"新":return"new";case"直播中":return"live";default:return""}}function V(a){y.value=!0,o.value.splice(a,1),localStorage.setItem("movieSearchHistory",JSON.stringify(o.value)),setTimeout(()=>{y.value=!1},300)}return N(()=>{v.setSearchKeyword(_.value)}),(a,t)=>(i(),l("div",ce,[c(C)?(i(),q(ne,{key:0})):S("",!0),e("main",re,[e("div",ue,[e("div",{id:"movie-wrapper",class:w(["w-full max-w-screen-xl m-auto",[c(C)?"p-2":"p-4"]])},[e("div",de,[e("div",he,[e("div",ve,[e("div",_e,[g(c(se),{value:_.value,"onUpdate:value":t[1]||(t[1]=s=>_.value=s),type:"text",placeholder:"请输入影视名称关键字",clearable:"",loading:f.value,onKeyup:t[2]||(t[2]=A(s=>m(),["enter"])),onFocus:F,onBlur:I},{suffix:$(()=>[g(c(X),{disabled:f.value,secondary:"",onClick:t[0]||(t[0]=s=>m())},{icon:$(()=>[g(c(Z),{icon:c(ee).nav.search,class:"search-icon"},null,8,["icon"])]),_:1},8,["disabled"])]),_:1},8,["value","loading"])]),G(e("div",{class:"search-suggestions",onMouseenter:O,onMouseleave:j},[o.value.length>0?(i(),l("div",fe,[e("div",pe,[me,e("span",{class:"clear-history",onClick:b(J,["stop"])},"清空",8,ge)]),e("div",ye,[e("div",Se,[(i(!0),l(x,null,k(o.value,(s,u)=>(i(),l("div",{key:`history-${u}`,class:"history-item",onClick:M=>m(s)},[e("span",xe,h(s),1),e("span",{class:"delete-icon",onClick:b(M=>V(u),["stop","prevent"])},"×",8,ke)],8,we))),128))])])])):S("",!0),e("div",Ce,[Ie,e("div",Me,[(i(!0),l(x,null,k(T.value,(s,u)=>(i(),l("div",{key:`hot-${u}`,class:"suggestion-item",onClick:M=>m(s.text)},[e("span",{class:w(["hot-rank",{"top-3":u<3}])},h(u+1),3),e("span",$e,h(s.text),1),s.tag?(i(),l("span",{key:0,class:w(["hot-tag",L(s.tag)])},h(s.tag),3)):S("",!0)],8,Ne))),128))])])],544),[[P,p.value]])])]),e("div",be,[(i(!0),l(x,null,k(c(K),s=>(i(),l("div",{key:s.vod_id,class:"movie-card",onClick:u=>c(H).push(`/movie/movie-detail/${s.vod_id}`)},[e("div",He,[g(c(ie),{lazy:"",src:s.vod_pic,alt:s.vod_name,"preview-disabled":"","object-fit":"cover","intersection-observer-options":{root:"#scrollRef",rootMargin:"200px 0px",threshold:.1}},null,8,["src","alt","intersection-observer-options"])]),e("div",Ke,[e("h3",null,h(s.vod_name),1),e("span",Re,h(s.type_name),1)])],8,Be))),128))])])],2)])])]))}});const De=ae(Te,[["__scopeId","data-v-307c35c7"]]);export{De as default};
